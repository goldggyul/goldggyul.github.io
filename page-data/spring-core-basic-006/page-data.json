{"componentChunkName":"component---src-templates-blog-template-js","path":"/spring-core-basic-006/","result":{"data":{"cur":{"id":"0a2054b3-a1fc-51a7-a306-00478b7e409b","html":"<blockquote>\n<p>본 게시글은 <a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8\">스프링 핵심 원리 - 기본편</a> 강의를 듣고 정리했습니다.</p>\n</blockquote>\n<h1 id=\"️-컴포넌트-스캔\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%8A%A4%EC%BA%94\" aria-label=\"️ 컴포넌트 스캔 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>☘️ 컴포넌트 스캔</h1>\n<h2 id=\"-컴포넌트-스캔과-의존관계-자동-주입-시작하기\" style=\"position:relative;\"><a href=\"#-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%8A%A4%EC%BA%94%EA%B3%BC-%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%84-%EC%9E%90%EB%8F%99-%EC%A3%BC%EC%9E%85-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\" aria-label=\" 컴포넌트 스캔과 의존관계 자동 주입 시작하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 컴포넌트 스캔과 의존관계 자동 주입 시작하기</h2>\n<p>지금까지 스프링 빈을 등록할 때는 자바 코드의 <code class=\"language-text\">@Bean</code>을 이용했다. (혹은 XML <code class=\"language-text\">&lt;bean></code>)</p>\n<p>예제에서는 몇개가 안되었지만, 이렇게 등록해야 할 스프링 빈이 수십, 수백개가 되면 일일이 등록하기도 귀찮고, 설정 정보도 커지고, 누락하는 문제도 발생한다. 역시 개발자는 반복을 싫어한다.(무엇보다 귀찮다 ㅠㅠ)</p>\n<p>그래서 스프링은 <u><strong>설정 정보가 없어도 자동으로 스프링 빈을 등록하는 컴포넌트 스캔</strong></u>이라는 기능을 제공한다.</p>\n<p>+) <u><strong>의존관계도 자동으로 주입</strong></u>하는 <code class=\"language-text\">@Autowired</code> 라는 기능도 제공한다.</p>\n<p>그럼 새로운 AppConfig를 만들어보자.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">AutoAppConfig</code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span>\n        excludeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ComponentScan.Filter</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">FilterType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ANNOTATION</span><span class=\"token punctuation\">,</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AutoAppConfig</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>컴포넌트 스캔을 사용하려면 먼저 <code class=\"language-text\">@ComponentScan</code> 을 설정 정보에 붙여주면 된다. 기존의 <code class=\"language-text\">AppConfig</code>와는 다르게 @Bean으로 등록한 클래스가 하나도 없다!</p>\n<blockquote>\n<p>컴포넌트 스캔을 사용하면 <code class=\"language-text\">@Configuration</code> 이 붙은 설정 정보도 자동으로 등록되기 때문에(@Configuration은 @Component를 포함하므로), AppConfig, TestConfig 등 앞서 만들어두었던 설정 정보도 함께 등록되고, 실행되어 버린다. 그래서 excludeFilters 를 이용해서 설정정보는 컴포넌트 스캔 대상에서 제외했다. 보통 설정 정보를 컴포넌트 스캔 대상에서 제외하지는 않지만, 기존 예제 코드를 최대한 남기고 유지하기 위함이다.</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><u><strong>컴포넌트 스캔</strong></u>은 이름 그대로 <code class=\"language-text\">@Component</code> 애노테이션이 붙은 클래스를 <u><strong>쫙 스캔해서 스프링 빈으로 등록</strong></u>해준다.</p>\n</li>\n<li>\n<p>그럼 이제 기존에 <code class=\"language-text\">@Bean</code>으로 등록했던 클래스에 <code class=\"language-text\">@Component</code>를 대신 붙이면 된다. <code class=\"language-text\">MemberServiceImpl</code>이나 <code class=\"language-text\">OrderServiceImpl</code>등…</p>\n<ul>\n<li>어라라? 근데 그러면 생성자에 어떤 걸 넣는 지 주입을 어떻게 해줄 수 있을까?</li>\n<li><code class=\"language-text\">AppConfig</code>에선 직접 넣어줬었는데…</li>\n<li>그래서 <u><strong>자동 의존 관계 주입이 필요하다!</strong></u> ➡️ 주입받고 싶은 생성자에 <code class=\"language-text\">@Autowired</code>를 붙이면 해당 타입의 객체를 자동으로 주입해준다. 그래서 <code class=\"language-text\">@ComponentScan</code>을 쓰면 <code class=\"language-text\">@Autowired</code>를 쓰게 된다.</li>\n</ul>\n</li>\n<li>\n<p>정상적으로 똑같이 동작한다!</p>\n<ul>\n<li>\n<p>컴포넌트 스캔하는 것도 로그로 나온다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.111111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAPklEQVQI1zWKyQ3AMAzDOleu1lcBF8n+4yiwg75ICbyGK2gZ2iuoxoh9f5pelNNpWv7RBIf/PO0zDd0FVQQbjtAjrv/124EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010223707524\"\n        title=\"image-20221010223707524\"\n        src=\"/static/93c8acd078a4c6b3b47b9badfa3ffd88/37523/image-20221010223707524.png\"\n        srcset=\"/static/93c8acd078a4c6b3b47b9badfa3ffd88/e9ff0/image-20221010223707524.png 180w,\n/static/93c8acd078a4c6b3b47b9badfa3ffd88/f21e7/image-20221010223707524.png 360w,\n/static/93c8acd078a4c6b3b47b9badfa3ffd88/37523/image-20221010223707524.png 720w,\n/static/93c8acd078a4c6b3b47b9badfa3ffd88/302a4/image-20221010223707524.png 1080w,\n/static/93c8acd078a4c6b3b47b9badfa3ffd88/07a9c/image-20221010223707524.png 1440w,\n/static/93c8acd078a4c6b3b47b9badfa3ffd88/34431/image-20221010223707524.png 1539w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p>자동 주입되는 것도 나온다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbElEQVQI1zWOWQ6DMAxEuRFS1QAhdeIlFArc/zpT2VU/nmzPInmgw8D3Bp/100G7obp2dbTzR+iHYWHBszQkapgqIxFjEQlmFjxyxbB2jXBWQemK9Y8pXm8LvOC3+3NjZBOUTaPjDzi+j4nwBQU4RcjUJGKXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010223636883\"\n        title=\"image-20221010223636883\"\n        src=\"/static/f449b4cc225b874fd9d3e1ded9d014ed/37523/image-20221010223636883.png\"\n        srcset=\"/static/f449b4cc225b874fd9d3e1ded9d014ed/e9ff0/image-20221010223636883.png 180w,\n/static/f449b4cc225b874fd9d3e1ded9d014ed/f21e7/image-20221010223636883.png 360w,\n/static/f449b4cc225b874fd9d3e1ded9d014ed/37523/image-20221010223636883.png 720w,\n/static/f449b4cc225b874fd9d3e1ded9d014ed/3cd52/image-20221010223636883.png 857w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>궁금증?</p>\n<hr>\n<p>빈으로 직접 등록하는 게 아니라 컴포넌트 스캔 방식을 쓸 때는, <code class=\"language-text\">@ComponentScan</code>과 함께 <code class=\"language-text\">@Configuration</code>을 쓰지 않아도 정상적으로 등록한다.</p>\n<p>물론 빈으로 직접 등록할 때는 <code class=\"language-text\">@Configuration</code>을 써야 <code class=\"language-text\">@Bean</code>으로 등록한 객체에 접근 시에 싱글톤 객체로 하나의 객체만 쓰이도록 해주기 때문에, 그 때는 <code class=\"language-text\">@Confiugration</code>이 필수지만, <code class=\"language-text\">@ComponentScan</code>으로 컴포넌트 스캔 방식을 쓴다고 지정할 때는, 함수로 생성해서 리턴해주는 게 아니기 때문에? 알아서 다 싱글톤으로 관리하면서 <code class=\"language-text\">@Component</code>가 붙은 클래스들을 스프링 빈으로 등록해서 필요 없는 게 아닐까? 이건 정확히는 모르겠다.</p>\n</blockquote>\n<h3 id=\"code-classlanguage-textcomponentscancode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textcomponentscancode\" aria-label=\"code classlanguage textcomponentscancode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">@ComponentScan</code></h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB50lEQVQozz2S607bQBSE/TCl2YvvjhNRbEJKgapSpT5sya8a3oJ7wuUHkAhhOwkKJCRftSvCkUZHq9WZOTuzTr/fpz/oMxyNqOuKqiqpypqqGlPVplfUdc3r6ytvb28sFguen585Pz/n9PSUm5ubzzvTnT+/99lq++R5Rqe7y3anS7a7RZ4l5FlGlnfI8pyiKJjNZozHYyswGo0YDoeUZcl0OrW4v7/H+d7dRsoNlNYWUmmEJxD+BiIQCE8ilOT46BhT8/ncbn13d4d5nREwQqvVygo5v352SUJBHMfEzZQ4aRK0XaKmJGqGBO0IL/Xo/evZwYeHBy4vL5lMJry8vPD09MTZ2Znd1GzsHOzvEAYN/MDHDyP8IMQNfXSokJFERgIdKQ6Lv0xnU66urri4uODx8dHC+Hh9fc3JyYkVc/Z/dPF1gziOSNIWaatF1mrR/BYRbsYEzRA3cekVh5RVye3trSUwfhkfTSiG1FhgBJy9vR18v4HruWj3A55GeQrtu8hQohNF7+iQelIzGAwsodnGEBgfjQVrEedgb4fQbZDEMUnaJk1bbLYjgk1FkEb4UWiJi+PiM5T393eWy6WF+Ubrsw0l3+7w5WsDqRQNIRBSoJVEK412vc/0jz5SNoMm0TVMrbsh/A+x3fN5KdWLfQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010223855718\"\n        title=\"image-20221010223855718\"\n        src=\"/static/dca34188738bd7a4e8e31aa2df003683/37523/image-20221010223855718.png\"\n        srcset=\"/static/dca34188738bd7a4e8e31aa2df003683/e9ff0/image-20221010223855718.png 180w,\n/static/dca34188738bd7a4e8e31aa2df003683/f21e7/image-20221010223855718.png 360w,\n/static/dca34188738bd7a4e8e31aa2df003683/37523/image-20221010223855718.png 720w,\n/static/dca34188738bd7a4e8e31aa2df003683/302a4/image-20221010223855718.png 1080w,\n/static/dca34188738bd7a4e8e31aa2df003683/07a9c/image-20221010223855718.png 1440w,\n/static/dca34188738bd7a4e8e31aa2df003683/8170e/image-20221010223855718.png 2132w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">@ComponentScan</code>이 되어 있으면, 스프링 컨테이너가 클래스를 다 뒤져서 <code class=\"language-text\">@Component</code>가 붙은 애들을 스프링 컨테이너에 등록을 한다.</p>\n<p>그런데! 이 때 등록을 할 때 이름은 클래스명에서 <u><strong>맨 앞글자를 소문자로 바꾼 것</strong></u>을 사용한다.</p>\n<ul>\n<li>빈 이름 기본 전략: <code class=\"language-text\">MemberServiceImpl</code> 클래스 ➡️ <code class=\"language-text\">memberServiceImpl</code></li>\n<li>빈 이름 직접 지정: 만약 스프링 빈의 이름을 직접 지정하고 싶으면 <code class=\"language-text\">@Component(\"memberService2\")</code> 이런식으로 이름을 부여하면 된다.</li>\n</ul>\n<h3 id=\"code-classlanguage-textautowiredcode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textautowiredcode\" aria-label=\"code classlanguage textautowiredcode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">@Autowired</code></h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABu0lEQVQoz3WSWW/aQBRG/VMaxTZeUGPGY7M5BuWlj83frlQpfYFgB7MYEJvYERgQfNW95SWKOtLRaMaab86dayVN++j1ehiNRjgejzgcDl+g/cvlgtPphPP5jM1mgyRJ0Gq10G63+TvtZ1kGJQxDeL6PUrmMsFa7E/Jcq9dRqVbx8/UVcRxz+Ha7ZabTKbNYLLDb7bDf7zGbzaB8d56g6jo0Xcejqv5D03jWdA3fHh5QLJYQxRFokAkFpGnKlS2XSza7Xq8cqtQCF9KxIYSEkB6EEJBOHkK4cKUP07AQ1AMk7YQPkgXZUtlkTIa0puD5fA6lXBSo+iZ86UD6Plwp4RYERIEukMgFKio/Svj9/gvZKUOn00EURfzmFNBoNHiv2WxiPB5D8TwXRddGxZfw3QKklPBKFUi/CCFd2MJGvfaCP+9vmK7HGKQDLnU4HLJtv9/n0MFgwG+qFISLnGHCsvOMadmwbPu+tqGqGqpBgOQj4RLJhiBDCqRuE91uF5PJhAIFDNO8h3zGzueh53IInp8Rf8TclNvthv8NulB5chw+RKGGYXzCtCzuNhlSWdTF1WqF9Xr9BfqVyPAv8s30yNoI9uoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010224155873\"\n        title=\"image-20221010224155873\"\n        src=\"/static/716663cfa5c972e0c5c245cfcea2a9f5/37523/image-20221010224155873.png\"\n        srcset=\"/static/716663cfa5c972e0c5c245cfcea2a9f5/e9ff0/image-20221010224155873.png 180w,\n/static/716663cfa5c972e0c5c245cfcea2a9f5/f21e7/image-20221010224155873.png 360w,\n/static/716663cfa5c972e0c5c245cfcea2a9f5/37523/image-20221010224155873.png 720w,\n/static/716663cfa5c972e0c5c245cfcea2a9f5/302a4/image-20221010224155873.png 1080w,\n/static/716663cfa5c972e0c5c245cfcea2a9f5/07a9c/image-20221010224155873.png 1440w,\n/static/716663cfa5c972e0c5c245cfcea2a9f5/c549b/image-20221010224155873.png 2128w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>생성자에 <code class=\"language-text\">@Autowired</code> 를 지정하면, 스프링 컨테이너가 자동으로 해당 스프링 빈을 찾아서 주입한다. 이때 기본 조회 전략은 <strong>타입이 같은 빈을 찾아서 주입</strong>한다.</p>\n<blockquote>\n<p>그럼 당연히 타입이 같은 게 여러개 있으면 충돌이 나겠죠? 그건 뒤에서~</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">getBean(MemberRepository.class)</code> 와 동일하다고 이해하면 된다. 더 자세한 내용은 뒤에서 설명한다.</li>\n</ul>\n<h2 id=\"-탐색-위치와-기본-스캔-대상\" style=\"position:relative;\"><a href=\"#-%ED%83%90%EC%83%89-%EC%9C%84%EC%B9%98%EC%99%80-%EA%B8%B0%EB%B3%B8-%EC%8A%A4%EC%BA%94-%EB%8C%80%EC%83%81\" aria-label=\" 탐색 위치와 기본 스캔 대상 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 탐색 위치와 기본 스캔 대상</h2>\n<p>컴포넌트 스캔 시에, 위에서 <code class=\"language-text\">@Configuration</code>이 붙은 클래스는 제외했던 것처럼, <code class=\"language-text\">basePackages</code>를 지정할 수 있다. 그럼 그 위치부터만 찾아 들어가는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span>\n basePackages <span class=\"token operator\">=</span> <span class=\"token string\">\"hello.core\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><u><strong>여러</strong></u> 시작 위치를 지정할 수도 있다. <code class=\"language-text\">basePackages = {\"hello.core\", \"hello.service\"}</code></li>\n<li><u><strong>지정하지 않으면</strong></u> <code class=\"language-text\">@ComponentScan</code>이 붙은 <u><strong>설정 정보 클래스의 패키지</strong></u>가 시작 위치가 된다.</li>\n<li><code class=\"language-text\">basePackageClasses</code>로 패키지가 아닌 <u><strong>클래스를 지정</strong></u>해서, 지정한 클래스의 패키지를 탐색 위치로 지정할 수도 있다.</li>\n</ul>\n<p>권장하는 방법은 패키지 위치를 지정하지 않고(그냥 기본으로 두고), <u><strong>설정 정보 클래스의 위치를 프로젝트 최상단에 두는 것</strong></u>이다. 최근 스프링 부트도 이 방법을 기본으로 제공한다.</p>\n<blockquote>\n<p>그리고 이 이유가 아니더라도, 프로젝트 메인 설정 정보는 <u><strong>프로젝트를 대표하는 정보이기 때문에 프로젝트 시작 루트 위치</strong></u>에 두는 것이 좋다 생각한다.</p>\n<p>스프링 부트를 사용하면 스프링 부트의 대표 시작 정보인 <code class=\"language-text\">@SpringBootApplication</code> 를 이 프로젝트 시작 루트 위치에 두는 것이 관례이다. (그리고 <u><strong>이 설정안에 바로 <code class=\"language-text\">@ComponentScan</code> 이 들어있다!</strong></u>)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 333px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.55555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACAUlEQVQoz3WS6VLbQBCE9TaJScAcwbYsWdIe2kOXJcyRhFABkvd/hS+1CyZAFT+mZmdrp7e7Z5Jx8HSNZdqGLOhay8XY0HcW7wxD70izis5ojCqYzVM+zzNm8zWfj9Z8Oc45PM35epLFnIyDi03b3uFdTV1LdqOlax1tY+K9tQZT1xijyDYCqxS1VDS1YrXOXsAi4O6ZjXM1bWNpG42zCqk0lVCUlURrTSkklVQUpUKHcyFiXqb5W8DAsPGGvrVRepB8vir5dJhyMM84mK+jvH3eS/0vOXsrOQANnYtgxgTJmoPjjNlz0+xd89Ezk9fxTrKPkq2tuZyayDSAyuBT/SRbSBVlL9LyhdFHkVxsfTQ+AAXwwDacgxXhg2BBqMObMJBgw3t2ryMJD/fehTUJfu5jiJM3kWkY2DqvPpT9hmFgEnIACEBt43BWYKWgKmRck7ZWyOppZcpCcHQuOM1LwpZYZyKhTEqSb6sNZ6uMs2VOmhVMY1ghjfOKQpU4KSg2guVaopWk1hqtVfS8qGT8xChJazWniw3J+cKSLhpOzjSb0rPrdjjd4+stRdEw9hPOefLKMI0t09gx9C1Xu55x29F6z9h5vHUsM0EyVg9cir+Y/IamuWUoH+jze8bikSF/xPV3/Lq95Pv1xJ/fV9xcT9zfPdXXV2Osf/7YUVvPKhf8A8jfp5gyVSFPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221011013241959\"\n        title=\"image-20221011013241959\"\n        src=\"/static/70c91fcf4df30f23376c8dc09d5aa04a/24c7e/image-20221011013241959.png\"\n        srcset=\"/static/70c91fcf4df30f23376c8dc09d5aa04a/e9ff0/image-20221011013241959.png 180w,\n/static/70c91fcf4df30f23376c8dc09d5aa04a/24c7e/image-20221011013241959.png 333w\"\n        sizes=\"(max-width: 333px) 100vw, 333px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>사실 그래서 스프링부트를 쓰면 <code class=\"language-text\">@ComponentScan</code>을 직접 쓸 일은 없다.</p>\n</blockquote>\n<ul>\n<li>\n<p>컴포넌트 스캔 기본 대상 (<code class=\"language-text\">@Component</code>를 포함하고 있음!)</p>\n<ul>\n<li>\n<p><code class=\"language-text\">@Component</code> : 컴포넌트 스캔에서 사용</p>\n</li>\n<li>\n<p><code class=\"language-text\">@Controlller</code> : 스프링 MVC 컨트롤러에서 사용</p>\n<ul>\n<li>스프링 MVC 컨트롤러로 인식</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">@Service</code> : 스프링 비즈니스 로직에서 사용</p>\n<ul>\n<li>사실 @Service 는 특별한 처리를 하지 않는다. 대신 개발자들이 핵심 비즈니스 로직이 여기에 있겠구나 라고 비즈니스 계층을 인식하는데 도움이 된다.</li>\n<li>그래서 보통 <code class=\"language-text\">@Service</code> 계층에서 <code class=\"language-text\">@Transaction</code>도 걸려 있다. 비즈니스 로직이 시작될 때 트랜잭션이 시작되는 게 맞으니까~</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">@Repository</code> : 스프링 데이터 접근 계층에서 사용</p>\n<ul>\n<li>\n<p>스프링 데이터 접근 계층으로 인식하고, <u><strong>데이터 계층의 예외를 스프링 추상화된 예외로 변환</strong></u>해준다.</p>\n<p>(뭔 소리냐면, db마다 예외가 다른데 db가 달라질 때마다 예외가 달라진다면 위에 계층(서비스 등)에도 영향을 미친다. 따라서 이런 일이 없도록 예외를 추상화해서 반환해준다.)</p>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">@Configuration</code> : 스프링 설정 정보에서 사용</p>\n<ul>\n<li>스프링 설정 정보로 인식하고, 스프링 빈이 싱글톤을 유지하도록 추가 처리를 한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>주의</p>\n<blockquote>\n<p>위 컴포넌트들의 소스 코드를 보면 <code class=\"language-text\">@Component</code>를 포함하고 있다고 나온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Controller</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Configuration</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 사실 애노테이션에는 상속관계라는 것이 없다. 그래서 이렇게 애노테이션이 특정 애노테이션을 들고 있는 것을 인식할 수 있는 것은 <u><strong>자바 언어가 지원하는 기능은 아니고, 스프링이 지원하는 기능이다.</strong></u></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"-필터\" style=\"position:relative;\"><a href=\"#-%ED%95%84%ED%84%B0\" aria-label=\" 필터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 필터</h2>\n<ul>\n<li>\n<p><code class=\"language-text\">includeFilters</code> : 컴포넌트 스캔 대상을 추가로 지정한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">excludeFilters</code> : 컴포넌트 스캔에서 제외할 대상을 지정한다.</p>\n</li>\n<li>\n<p>테스트</p>\n<p>애노테이션 2개를 만들어서, <code class=\"language-text\">@MyIncludeComponent</code>가 있는 클래스는 스캔하도록 하고, <code class=\"language-text\">@MyExcludeComponent</code>가 있는 클래스는 스캔하지 않도록 해보자.</p>\n<ul>\n<li>\n<p>컴포넌트 만들기</p>\n<p><code class=\"language-text\">@MyIncludeComponent</code></p>\n<ul>\n<li>\n<p>위에 애노테이션들은 <code class=\"language-text\">@Component</code>에 있는 것들</p>\n</li>\n<li>\n<p><code class=\"language-text\">@Target</code>으로 이 애노테이션이 어디에 붙는 애노테이션인지 알려준다. 이 경우 클래스</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//어디에 붙냐? Type -> 클래스</span>\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Documented</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">MyIncludeComponent</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n</li>\n</ul>\n<p><code class=\"language-text\">@MyExcludeComponent</code></p>\n<ul>\n<li>위와 동일</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">@ComponentScan</code></p>\n<ul>\n<li>\n<p><code class=\"language-text\">@MyIncludeComponent</code>는 포함하고, <code class=\"language-text\">@MyExcludeComponent</code>는 포함하지 않도록 해보자.</p>\n<blockquote>\n<p>근데 여기서, 그 전에 컴포넌트 스캔시에는 includeFilter를 안해줘도 컴포넌트들을 읽었던 게 생각나서 Include를 안해보니까 읽히지 않았다. <code class=\"language-text\">@MyIncludeComponent</code>가 커스텀 애노테이션이라서(<code class=\"language-text\">@Component</code>가 포함되지 않은) 직접 등록해줘야 읽는다.</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">ComponentScan</code>을 static import한 후에, 그냥 <code class=\"language-text\">@Filter</code>로 써도 된다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ComponentFilterAppConfigTest</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">//...</span>\n  \n    <span class=\"token annotation punctuation\">@Configuration</span>\n    <span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span>\n            includeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ComponentScan.Filter</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">FilterType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ANNOTATION</span><span class=\"token punctuation\">,</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">MyIncludeComponent</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            excludeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ComponentScan.Filter</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">FilterType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ANNOTATION</span><span class=\"token punctuation\">,</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">MyExcludeComponent</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ComponentFilterAppConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>위 애노테이션이 등록된 클래스 만들기</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@MyIncludeComponent</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BeanA</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@MyExcludeComponent</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BeanB</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>테스트</p>\n<ul>\n<li>예상대로 <code class=\"language-text\">@MyIncludeComponent</code>가 붙은 <code class=\"language-text\">BeanA</code> 빈은 스프링 컨테이너에 동륵되어 있었고, <code class=\"language-text\">@MyExcludeComponent</code>는 없었다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">includeComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">ApplicationContext</span> ac <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ComponentFilterAppConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">BeanA</span> bean <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanA</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNotNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">excludeComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">ApplicationContext</span> ac <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ComponentFilterAppConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">assertThrows</span><span class=\"token punctuation\">(</span>\n    <span class=\"token class-name\">NoSuchBeanDefinitionException</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanB</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>FilterType 5가지 옵션</p>\n<ul>\n<li>\n<p><code class=\"language-text\">ANNOTATION</code>: 기본값, 애노테이션을 인식해서 동작한다. 이 애노테이션이 있는 곳을 include/혹은 exclude~</p>\n<p>ex) org.example.SomeAnnotation</p>\n<ul>\n<li>\n<p>그래서 그냥 타입을 안줘도 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span>\n  includeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Filter</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* type = FilterType.ANNOTATION,*/</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">MyIncludeComponent</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  excludeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Filter</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* type = FilterType.ANNOTATION,*/</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">MyExcludeComponent</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ComponentFilterAppConfig</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">ASSIGNABLE_TYPE</code>: 지정한 타입과 자식 타입을 인식해서 동작한다. 클래스 지정!</p>\n<p>ex) org.example.SomeClass</p>\n<p>예를 들어서 BeanA도 빼고 싶으면 다음과 같이 추가하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span>\n    includeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Filter</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* type = FilterType.ANNOTATION,*/</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">MyIncludeComponent</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    excludeFilters <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token annotation punctuation\">@Filter</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* type = FilterType.ANNOTATION,*/</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">MyExcludeComponent</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token annotation punctuation\">@Filter</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">FilterType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ASSIGNABLE_TYPE</span><span class=\"token punctuation\">,</span> classes <span class=\"token operator\">=</span> <span class=\"token class-name\">BeanA</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ComponentFilterAppConfig</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>ASPECTJ: AspectJ 패턴 사용</p>\n<p>ex) org.example..*Service+ *</p>\n</li>\n<li>\n<p>REGEX: 정규 표현식</p>\n<p>ex) org.example.Default.*</p>\n</li>\n<li>\n<p>CUSTOM: TypeFilter 이라는 인터페이스를 구현해서 처리</p>\n</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>참고: <strong><code class=\"language-text\">@Component</code> 면 충분</strong>하기 때문에, <code class=\"language-text\">includeFilters</code> 를 사용할 일은 거의 없다. <code class=\"language-text\">excludeFilters</code> 는 여러가지 이유로 간혹 사용할 때가 있지만 많지는 않다.</p>\n<ul>\n<li>위에 처럼 <code class=\"language-text\">@Configuration</code>이 포함된 클래스를 또 중복으로 읽어서 문제가 생기는 걸 방지하기 위해 제외한다든지…</li>\n</ul>\n<p>특히 최근 스프링 부트는 컴포넌트 스캔을 기본으로 제공하는데, 개인적으로는 옵션을 변경하면서 사용하기 보다는 스프링의 기본 설정에 최대한 맞추어 사용하는 것을 권장하고, 선호하는 편이다.</p>\n</blockquote>\n<h2 id=\"-중복-등록과-충돌\" style=\"position:relative;\"><a href=\"#-%EC%A4%91%EB%B3%B5-%EB%93%B1%EB%A1%9D%EA%B3%BC-%EC%B6%A9%EB%8F%8C\" aria-label=\" 중복 등록과 충돌 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 중복 등록과 충돌</h2>\n<p>컴포넌트 스캔에서 같은 빈 이름을 등록하면 어떻게 될까?</p>\n<p>다음 두가지 상황이 있다.</p>\n<ol>\n<li>\n<p>자동 빈 등록 vs 자동 빈 등록</p>\n<p>컴포넌트 스캔에 의해 자동으로 스프링 빈이 등록되는데, 그 이름이 같은 경우 스프링은 오류를 발생시킨다.</p>\n<ul>\n<li><code class=\"language-text\">ConflictingBeanDefinitionException</code> 예외 발생</li>\n</ul>\n</li>\n<li>\n<p>수동 빈 등록 vs 자동 빈 등록</p>\n<p>만약 수동 빈 등록과 자동 빈 등록에서 빈 이름이 충돌되면 어떻게 될까?</p>\n<ul>\n<li>\n<p>자동 빈 등록</p>\n<p>이미 <code class=\"language-text\">MemoryMemberRepository</code>가 컴포넌트로 등록이 되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemoryMemberRepository</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>수동 빈 등록</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span>\n   excludeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Filter</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">FilterType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ANNOTATION</span><span class=\"token punctuation\">,</span> classes <span class=\"token operator\">=</span>\n  <span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AutoAppConfig</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">//수동으로 같은 이름으로 등록!</span>\n   <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"memoryMemberRepository\"</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MemoryMemberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>이 경우 <u><strong>수동 빈 등록이 우선권</strong></u>을 가진다. (<u><strong>수동 빈이 자동 빈을 오버라이딩</strong></u> 해버린다.)</p>\n<p>➡️ 출력창에도 <code class=\"language-text\">Overriding bean definition for bean 'memoryMemberRepository' with a different definition: replacing...</code> 하면서 메세지를 잘 나타내준다.</p>\n<p>물론 개발자가 의도적으로 이런 결과를 기대했다면, 자동 보다는 수동이 우선권을 가지는 것이 좋다. 하지만 현실은 개발자가 의도적으로 설정해서 이런 결과가 만들어지기 보다는 여러 설정들이 꼬여서 이런 결과가 만들어지는 경우가 대부분이다!</p>\n<p>그러면 <u><strong>정말 잡기 어려운 버그가 만들어진다. 항상 잡기 어려운 버그는 애매한 버그</strong></u>다.</p>\n<p>그래서 최근 스프링 부트에서는 수동 빈 등록과 자동 빈 등록이 충돌나면 오류가 발생하도록 기본 값을 바꾸었다.</p>\n<p>그래서 위에처럼 테스트코드 말고 <code class=\"language-text\">@SpringBootApplication</code>이 있는, 스프링부트를 통해서 실행하면 바로 에러가 나고 애플리케이션이 실행이 되지 않는다.</p>\n<ul>\n<li>\n<p>출력창에 어디에 이미 등록돼서 또 등록될 수 없다. 그리고 오버라이딩 조건이 false로 되어있다고 나온다. (스프링은 오버라이딩을 기본으로 해주지만 부트는 오버라이딩 안되도록 기본값이 false로 되어 있다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Consider renaming one of the beans or enabling overriding by setting\nspring.main.allow-bean-definition-overriding=true</code></pre></div>\n<p>위 조건을 properties에 true로 하면 되긴 된다.</p>\n</li>\n</ul>\n</li>\n</ol>\n<blockquote>\n<h3 id=\"애매한-상황을-만들지-말자\" style=\"position:relative;\"><a href=\"#%EC%95%A0%EB%A7%A4%ED%95%9C-%EC%83%81%ED%99%A9%EC%9D%84-%EB%A7%8C%EB%93%A4%EC%A7%80-%EB%A7%90%EC%9E%90\" aria-label=\"애매한 상황을 만들지 말자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>애매한 상황을 만들지 말자!!!</h3>\n<p>코드가 반복되거나 일이 더 많아도 항상 더 명확하게 하자. 애매한 상황은 잡기 힘든 버그를 만든다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%8A%A4%EC%BA%94\">☘️ 컴포넌트 스캔</a></p>\n<ul>\n<li>\n<p><a href=\"#-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%8A%A4%EC%BA%94%EA%B3%BC-%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%84-%EC%9E%90%EB%8F%99-%EC%A3%BC%EC%9E%85-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\">📌 컴포넌트 스캔과 의존관계 자동 주입 시작하기</a></p>\n<ul>\n<li><a href=\"#componentscan\"><code class=\"language-text\">@ComponentScan</code></a></li>\n<li><a href=\"#autowired\"><code class=\"language-text\">@Autowired</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%ED%83%90%EC%83%89-%EC%9C%84%EC%B9%98%EC%99%80-%EA%B8%B0%EB%B3%B8-%EC%8A%A4%EC%BA%94-%EB%8C%80%EC%83%81\">📌 탐색 위치와 기본 스캔 대상</a></p>\n</li>\n<li>\n<p><a href=\"#-%ED%95%84%ED%84%B0\">📌 필터</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%A4%91%EB%B3%B5-%EB%93%B1%EB%A1%9D%EA%B3%BC-%EC%B6%A9%EB%8F%8C\">📌 중복 등록과 충돌</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"본 게시글은 스프링 핵심 원리 - 기본편 강의를 듣고 정리했습니다. ☘️ 컴포넌트 스캔 📌 컴포넌트 스캔과 의존관계 자동 주입 시작하기 지금까지 스프링 빈을 등록할 때는 자바 코드의 을 이용했다. (혹은 XML ) 예제에서는 몇개가 안되었지만, 이렇게 등록해야 할 스프링 빈이 수십, 수백개가 되면 일일이 등록하기도 귀찮고, 설정 정보도 커지고, 누락하는 문제도 발생한다. 역시 개발자는 반복을 싫어한다.(무엇보다 귀찮다 ㅠㅠ) 그래서 스프링은 설정 정보가 없어도 자동으로 스프링 빈을 등록하는 컴포넌트 스캔이라는 기능을 제공한다. +) 의존관계도 자동으로 주입하는  라는 기능도 제공한다. 그럼 새로운 AppConfig를 만들어보자.  컴포넌트 스캔을 사용하려면 먼저  을 설정 정보에 붙여주면 된다. 기존의 와는 다르게 @Bean으로 등록한 클래스가 하나도 없다! 컴포넌트 스캔을 사용하면  이 붙은 설정 정보도 자동으로 등록되기 때문에(@Configuration은 @Component를 포…","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%8A%A4%EC%BA%94\">☘️ 컴포넌트 스캔</a></p>\n<ul>\n<li>\n<p><a href=\"#-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%8A%A4%EC%BA%94%EA%B3%BC-%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%84-%EC%9E%90%EB%8F%99-%EC%A3%BC%EC%9E%85-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\">📌 컴포넌트 스캔과 의존관계 자동 주입 시작하기</a></p>\n<ul>\n<li><a href=\"#code-classlanguage-textcomponentscancode\"><code class=\"language-text\">@ComponentScan</code></a></li>\n<li><a href=\"#code-classlanguage-textautowiredcode\"><code class=\"language-text\">@Autowired</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%ED%83%90%EC%83%89-%EC%9C%84%EC%B9%98%EC%99%80-%EA%B8%B0%EB%B3%B8-%EC%8A%A4%EC%BA%94-%EB%8C%80%EC%83%81\">📌 탐색 위치와 기본 스캔 대상</a></p>\n</li>\n<li>\n<p><a href=\"#-%ED%95%84%ED%84%B0\">📌 필터</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%A4%91%EB%B3%B5-%EB%93%B1%EB%A1%9D%EA%B3%BC-%EC%B6%A9%EB%8F%8C\">📌 중복 등록과 충돌</a></p>\n</li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"October 10, 2022","title":"컴포넌트 스캔 - 스프링 핵심 원리 기본편 06","categories":"강의","author":"goldggyul","emoji":null,"imageEmoji":"spring-logo.png"},"fields":{"slug":"/spring-core-basic-006/"}},"next":{"id":"79da52e7-0186-5fa8-aa41-3b282b617451","html":"<blockquote>\n<p>본 게시글은 <a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8\">스프링 핵심 원리 - 기본편</a> 강의를 듣고 정리했습니다.</p>\n</blockquote>\n<h1 id=\"️-싱글톤-컨테이너\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EC%8B%B1%EA%B8%80%ED%86%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88\" aria-label=\"️ 싱글톤 컨테이너 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>☘️ 싱글톤 컨테이너</h1>\n<p>‘싱글톤 패턴’이라고 말하는 그 싱글톤이다! 객체가 JVM 안에 딱 하나 있는 것.</p>\n<h2 id=\"-웹-애플리케이션과-싱글톤\" style=\"position:relative;\"><a href=\"#-%EC%9B%B9-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EA%B3%BC-%EC%8B%B1%EA%B8%80%ED%86%A4\" aria-label=\" 웹 애플리케이션과 싱글톤 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 웹 애플리케이션과 싱글톤</h2>\n<p>대부분의 스프링 애플리케이션은 웹 애플리케이션이다. (데몬, 배치 등 다른 개발도 얼마든지 할 수 있다.)</p>\n<ul>\n<li>\n<p>그런데 웹 애플리케이션은 보통 여러 고객이 동시에 요청을 한다. 우리가 지금 만든 Bean들은 어떻게 동작을 할까?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABz0lEQVQoz2VSTWvbUBDUj0n7L9p7zi0E8lPaW8ghF1/ingqF4h5acnVKL7VCfTNOaQ42lmyBUSzLSLYlP8mSsC1pyqwqN6UPhuV97O7MvNWKogBXnucC7p+CZ/v9XhCGIQaDAYbDIayJJdEwDUwmE+x2O4GWJAnSNMXTVZblEVzr9Rqr1QqbzQZBEEAFCo7rwHVdrP21RN6xoabrOprNplSfz+ewLAvj8Ri2bcueD5fLpdwXeQEVKbz9+gYv373A6ftT3Dv3FQlUzTXS7na7kuh5njBhx9lsJmDh6XQqRcmA8c68w5efn3Hz6wZe5Emhoqws0qh/NBodpR4OB5FFdovFQhpRci1f/C5zPAaPCJLgmFdHrdPpoNFoSBIZmaYJwzBEOpnWjOkzP4Yqzj6c4eTyBM8vn0Ef61WTIq8KUhI9I93tdiuJWZYJuCfYqJYcxzGKokSYhsj22f8M+/0+2u22HFAumZKF7/sil2OjlPqbhBK3w1tcfb/C9Y9r2IFdefhnzLRer4dWqyXSKJMgI8epxoI+MnK8WJjeXny7wOuPr3D+6RwP7sM/I6fxAdnUQ0yWlBVFkRRgoboR3y39JVKVQoUKiUoQb2Kxg4QYfwNraeDHQV6BYwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010044454432\"\n        title=\"image-20221010044454432\"\n        src=\"/static/2caf16de2a9137a733e28df0ecf9b8b8/37523/image-20221010044454432.png\"\n        srcset=\"/static/2caf16de2a9137a733e28df0ecf9b8b8/e9ff0/image-20221010044454432.png 180w,\n/static/2caf16de2a9137a733e28df0ecf9b8b8/f21e7/image-20221010044454432.png 360w,\n/static/2caf16de2a9137a733e28df0ecf9b8b8/37523/image-20221010044454432.png 720w,\n/static/2caf16de2a9137a733e28df0ecf9b8b8/302a4/image-20221010044454432.png 1080w,\n/static/2caf16de2a9137a733e28df0ecf9b8b8/07a9c/image-20221010044454432.png 1440w,\n/static/2caf16de2a9137a733e28df0ecf9b8b8/098d4/image-20221010044454432.png 2142w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>우린 지금 <u><strong>요청이 올 때마다 객체를 새로 만들고 있다</strong></u>! 이런 식으로 계속 생성하는 건 말이 안된다.</p>\n<ul>\n<li>\n<p>테스트 코드: 실제로 테스트해봐도 둘은 다른 객체다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"스프링 없는 순수한 DI 컨테이너의 문제점\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">pureContainer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">AppConfig</span> appConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AppConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 조회: 호출할 때마다 객체를 생성하는지 확인</span>\n  <span class=\"token class-name\">MemberService</span> memberService1 <span class=\"token operator\">=</span> appConfig<span class=\"token punctuation\">.</span><span class=\"token function\">memberService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">MemberService</span> memberService2 <span class=\"token operator\">=</span> appConfig<span class=\"token punctuation\">.</span><span class=\"token function\">memberService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 참조값이 다르다.</span>\n  <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>memberService1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNotSameAs</span><span class=\"token punctuation\">(</span>memberService2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>따라서 해결방안은 <u><strong>해당 객체가 딱 1개만 생성되고, 공유하도록 설계하면 된다.</strong></u> ➡️ <code class=\"language-text\">싱글톤 패턴</code></p>\n</li>\n</ul>\n<h2 id=\"-싱글톤-패턴\" style=\"position:relative;\"><a href=\"#-%EC%8B%B1%EA%B8%80%ED%86%A4-%ED%8C%A8%ED%84%B4\" aria-label=\" 싱글톤 패턴 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 싱글톤 패턴</h2>\n<p>싱글톤 패턴을 적용한 예제 코드를 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SingletonService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// 내부에 자기 자신을 static으로 하나 갖고 있는다.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SingletonService</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SingletonService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SingletonService</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SingletonService</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"싱글톤 객체 로직 호출\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>static 영역에 객체 instance를 <u><strong>미리 하나 생성</strong></u>해서 올려둔다. (자바가 뜰 때)</li>\n<li>이 객체 인스턴스가 필요하면 오직 getInstance() 메서드를 통해서만 조회할 수 있다. 이 메서드를 호출하면 항상 같은 인스턴스를 반환한다.</li>\n<li>딱 1개의 객체 인스턴스만 존재해야 하므로, <u><strong>생성자를 private으로 막아서 혹시라도 외부에서 new 키워드로 객체 인스턴스가 생성되는 것을 막는다.</strong></u>\n<ul>\n<li>가장 좋은 건 컴파일 오류. 잘 설계한 객체는 웬만하면 컴파일 과정에서 오류가 나야 한다.</li>\n</ul>\n</li>\n</ol>\n<ul>\n<li>\n<p>테스트 코드</p>\n<ul>\n<li><code class=\"language-text\">isEqualTo</code> vs. <code class=\"language-text\">isSameAs</code>\n<ul>\n<li>Same은 진짜 자바 <code class=\"language-text\">==</code> 비교. 즉, 참조 비교</li>\n<li>Equal은 Equals 비교.</li>\n<li>이 경우 같은 객체인지 비교해야하므로 참조를 비교한다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"싱글톤 패턴을 적용한 객체 사용\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">singletonServiceTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">//private으로 생성자를 막아두었다. 컴파일 오류가 발생한다.</span>\n   <span class=\"token comment\">//new SingletonService();</span>\n   <span class=\"token comment\">//1. 조회: 호출할 때 마다 같은 객체를 반환</span>\n   <span class=\"token class-name\">SingletonService</span> singletonService1 <span class=\"token operator\">=</span> <span class=\"token class-name\">SingletonService</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token comment\">//2. 조회: 호출할 때 마다 같은 객체를 반환</span>\n   <span class=\"token class-name\">SingletonService</span> singletonService2 <span class=\"token operator\">=</span> <span class=\"token class-name\">SingletonService</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token comment\">//참조값이 같은 것을 확인</span>\n   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"singletonService1 = \"</span> <span class=\"token operator\">+</span> singletonService1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"singletonService2 = \"</span> <span class=\"token operator\">+</span> singletonService2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token comment\">// singletonService1 == singletonService2</span>\n   <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>singletonService1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isSameAs</span><span class=\"token punctuation\">(</span>singletonService2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   singletonService1<span class=\"token punctuation\">.</span><span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>private으로 new 키워드를 막아두어서 외부에서 객체 생성이 안된다.</li>\n<li>호출할 때 마다 같은 객체 인스턴스를 반환하는 것을 확인할 수 있다</li>\n</ul>\n<blockquote>\n<p>참고: 싱글톤 패턴을 구현하는 방법은 여러가지가 있다. 여기서는 <u><strong>객체를 미리 생성</strong></u>해두는 가장 단순하고 안전한 방법을 선택했다.</p>\n<p>지연 생성해두는 방법도 있지만, 객체 인스턴스가 메모리를 많이 잡아먹는 게 아니면 로딩할 때 만드는 게 가장 간편하고 안전하다.</p>\n<blockquote>\n<h3 id=\"이른-초기화-eager-initialization\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%A5%B8-%EC%B4%88%EA%B8%B0%ED%99%94-eager-initialization\" aria-label=\"이른 초기화 eager initialization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이른 초기화: Eager Initialization.</h3>\n<p>클래스 static 특징을 이용해서, 클래스 로더가 초기화하는 시점에 인스턴스를 메모리해두는 방법.</p>\n<p>(null인지 체크하고 생성하는 방법 말고) static 변수 <u><strong>선언과 동시에 초기화</strong></u>를 해주면 클래스 로더가 객체를 생성해주므로 동시성 문제가 해결된다.</p>\n<p>이게 위에서 적용한 방법이다.</p>\n<h3 id=\"lazy-initialization-lazyholder\" style=\"position:relative;\"><a href=\"#lazy-initialization-lazyholder\" aria-label=\"lazy initialization lazyholder permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lazy Initialization, LazyHolder.</h3>\n<p>클래스 안에 static inner class로 helper를 이용해서 생성한다. 미리 올려두는 게 아니고 해당 이너클래스에서 인스턴스를 받아올 때, <u><strong>이너클래스 호출 시점에 이너클래스가 로딩</strong></u>돼서 호출되기 전에 미리 메모리에 올라가지 않는다. 또한 클래스 로더에 의해 객체가 생성되므로 Thread-safe를 보장한다.</p>\n<ul>\n<li>초기화 비용이 큰 클래스들의 경우 클래스 로드 시점에 한꺼번에 초기화돼서 메모리의 부담을 줄일 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CardCompany</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">CardCompany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//...</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CardCompanyHelper</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">CardCompany</span> cardCompany <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CardCompany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">CardCompany</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">CardCompanyHelper</span><span class=\"token punctuation\">.</span>cardCompany<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  \n    <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</blockquote>\n</blockquote>\n</li>\n<li>\n<p>그럼 이제 모든 클래스를 싱글톤 패턴을 적용시키면 되겠죠? 하지만! 스프링 컨테이너를 쓰면 기본적으로 객체를 다 싱글톤으로 만들어서 관리해준다.</p>\n</li>\n<li>\n<p>싱글톤 패턴을 적용하면 고객의 요청이 올 때 마다 객체를 생성하는 것이 아니라, 이미 만들어진 객체를 공유해서 효율적으로 사용할 수 있다. 하지만 <u><strong>싱글톤 패턴은 다음과 같은 수 많은 문제점들</strong></u>을 가지고 있다.</p>\n<ul>\n<li>싱글톤 패턴을 <u><strong>구현하는 코드 자체가 많이</strong></u> 들어간다.</li>\n<li>의존관계상 클라이언트가 구체 클래스에 의존한다. (구체 클래스에서 getInstance를 해서 객체를 받아와야 하기 때문) ➡️ DIP를 위반한다.\n<ul>\n<li>클라이언트가 구체 클래스에 의존해서 OCP 원칙을 위반할 가능성이 높다.</li>\n</ul>\n</li>\n<li>테스트하기 어렵다.\n<ul>\n<li>인스턴스를 설정을 끝내고 받아오므로 유연하게 테스트하기가 어렵다.</li>\n</ul>\n</li>\n<li>내부 속성을 변경하거나 초기화 하기 어렵다.</li>\n<li>private 생성자로 <u><strong>자식 클래스를 만들기 어렵다.</strong></u></li>\n<li><code class=\"language-text\">결론적으로 유연성이 떨어진다.</code></li>\n<li>안티패턴으로 불리기도 한다.</li>\n</ul>\n</li>\n<li>\n<p>그런데 스프링 프레임워크는 <u><strong>이 단점은 모두 해결</strong></u>하고! 객체를 싱글톤으로 관리해준다.</p>\n</li>\n</ul>\n<h2 id=\"-싱글톤-컨테이너-스프링-컨테이너\" style=\"position:relative;\"><a href=\"#-%EC%8B%B1%EA%B8%80%ED%86%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88\" aria-label=\" 싱글톤 컨테이너 스프링 컨테이너 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 싱글톤 컨테이너 (스프링 컨테이너)</h2>\n<blockquote>\n<p>스프링 컨테이너는 싱글톤 패턴의 문제점을 해결하면서, 객체 인스턴스를 싱글톤(1개만 생성)으로 관리한다. 지금까지 우리가 학습한 스프링 빈이 바로 싱글톤으로 관리되는 빈이다.</p>\n<p>스프링 컨테이너는 싱글턴 패턴을 적용하지 않아도, 객체 인스턴스를 싱글톤으로 관리한다.</p>\n<p>스프링 컨테이너는 싱글톤 컨테이너 역할을 한다. 이렇게 싱글톤 객체를 생성하고 관리하는 기능을 <code class=\"language-text\">싱글톤 레지스트리</code>라 한다. 스프링 컨테이너의 이런 기능 덕분에 싱글턴 패턴의 모든 <u><strong>단점</strong></u>을 해결하면서 객체를 싱글톤으로 유지할 수 있다.</p>\n<ul>\n<li>싱글톤 패턴을 위한 지저분한 코드가 들어가지 않아도 된다.</li>\n<li>DIP, OCP, 테스트, private 생성자로 부터 자유롭게 싱글톤을 사용할 수 있다.\n<ul>\n<li>유연성 떨어지고, 상속 안되고 등등..</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<ul>\n<li>\n<p>테스트 코드</p>\n</li>\n<li>\n<p>둘이 같은 객체(참조)다!</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"스프링 컨테이너와 싱글톤\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">springContainer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">ApplicationContext</span> ac <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AppConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">MemberService</span> memberService1 <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberService\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MemberService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">MemberService</span> memberService2 <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberService\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MemberService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>memberService1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isSameAs</span><span class=\"token punctuation\">(</span>memberService2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>싱글톤 컨테이너 적용 후</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhElEQVQoz41SQYrCQBDMfzztP3zYwt7dk1eP4gc8iBdBEDSiKArGxBhjEmOi0cQktVTLuOuyyDY0w/TMVFdVj1YUBcqyxO12Q57nkqwx1Z5n1+sVWZZhv99D13Usl0uMRiMsFgukaSp5uVygnU4nufgqCHI4HBCGIXzfh+u68DxP6lx5FkURVqsVtFarhXq9LhfX67V0nEwmmM/nsG1bHgdBgP8EwbXBYIBerycsWSAAO6vcbDbYbrcPdsfjEVEYIYkToLwD0R6lRBuPx0JVBf1UnipvyJSXHceRhk7gQDd12KGNorzP4AHYbDZRq9XEB7KZTqcimatlWTBNE7vdDiVKZGkG13NR/ayi8l7B28cb+kb/yWuNXtE3TpGgHNL5fJaVRlOmYRgimXvWZ8YMQ2sIIzCQF/kzw06ng263K4XfPhKYkgnEiOMYnu89vLt79O0h32ntdhuNRkNkUaKSyeQwyI4ecxhJkrycMtVo/CoE4xDIgGx+JqUSVP1FKvgreUbrvgB0te7FjddNlAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010175716380\"\n        title=\"image-20221010175716380\"\n        src=\"/static/d60c4113ff842c8e208c195490675e7c/37523/image-20221010175716380.png\"\n        srcset=\"/static/d60c4113ff842c8e208c195490675e7c/e9ff0/image-20221010175716380.png 180w,\n/static/d60c4113ff842c8e208c195490675e7c/f21e7/image-20221010175716380.png 360w,\n/static/d60c4113ff842c8e208c195490675e7c/37523/image-20221010175716380.png 720w,\n/static/d60c4113ff842c8e208c195490675e7c/302a4/image-20221010175716380.png 1080w,\n/static/d60c4113ff842c8e208c195490675e7c/07a9c/image-20221010175716380.png 1440w,\n/static/d60c4113ff842c8e208c195490675e7c/e2cbf/image-20221010175716380.png 2138w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>스프링 컨테이너 덕분에 고객의 요청이 올 때 마다 객체를 생성하는 것이 아니라, 이미 만들어진 객체를 공유해서 효율적으로 재사용할 수 있다.</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>참고: 스프링의 기본 빈 등록 방식은 싱글톤이지만, 싱글톤 방식만 지원하는 것은 아니다. 요청할 때 마다 새로운 객체를 생성해서 반환하는 기능도 제공한다.</p>\n<p>거의 99%는 싱글톤 빈만 쓰지만, 가끔 HttpRequest에 맞춰서 고객이 들어올 때 만들고 나갈 때 없앤다든가 그럴 일이 있는데, 자세한 걸 뒤에 빈 스코프에서 설명!</p>\n</blockquote>\n<h2 id=\"-싱글톤-방식의-주의점-\" style=\"position:relative;\"><a href=\"#-%EC%8B%B1%EA%B8%80%ED%86%A4-%EB%B0%A9%EC%8B%9D%EC%9D%98-%EC%A3%BC%EC%9D%98%EC%A0%90-\" aria-label=\" 싱글톤 방식의 주의점  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 싱글톤 방식의 주의점 ✨</h2>\n<p>객체 인스턴스를 하나만 생성해서 공유하는 싱글톤 방식은 여러 클라이언트가 하나의 같은 객체 인스턴스를 공유하기 때문에 <u><strong>싱글톤 객체는 상태를 유지(stateful)하게 설계하면 안된다</strong></u>.</p>\n<p>실무에서 자주 발생하니까 조심하기!</p>\n<h3 id=\"스프링-빈은-항상-code-classlanguage-text무상태statelesscode로-설계하기\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B9%88%EC%9D%80-%ED%95%AD%EC%83%81-code-classlanguage-text%EB%AC%B4%EC%83%81%ED%83%9Cstatelesscode%EB%A1%9C-%EC%84%A4%EA%B3%84%ED%95%98%EA%B8%B0\" aria-label=\"스프링 빈은 항상 code classlanguage text무상태statelesscode로 설계하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 빈은 항상 <code class=\"language-text\">무상태(stateless)</code>로 설계하기!</h3>\n<ul>\n<li>\n<p>특정 클라이언트에 의존적인 필드가 있으면 안된다.</p>\n</li>\n<li>\n<p>특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안된다! 가급적 읽기만 가능해야 한다.</p>\n</li>\n<li>\n<p>필드 대신에 자바에서 공유되지 않는, 지역변수, 파라미터, ThreadLocal 등을 사용해야 한다.</p>\n</li>\n<li>\n<p>스프링 빈(싱글톤 객체)의 <u><strong>필드에 공유 값을 설정</strong></u>하면 정말 큰 장애가 발생할 수 있다!!!</p>\n</li>\n<li>\n<h3 id=\"테스트-코드\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C\" aria-label=\"테스트 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 코드</h3>\n<ul>\n<li>\n<p>단축키</p>\n<p><code class=\"language-text\">command + shift + T</code>: 테스트 생성</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">statefulServiceSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">ApplicationContext</span> ac <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TestConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token class-name\">StatefulService</span> statefulService1 <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StatefulService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">StatefulService</span> statefulService2 <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StatefulService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//ThreadA: A사용자 10000원 주문</span>\n  statefulService1<span class=\"token punctuation\">.</span><span class=\"token function\">order</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"menu1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">//ThreadB: B사용자 20000원 주문</span>\n  statefulService2<span class=\"token punctuation\">.</span><span class=\"token function\">order</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"menu2\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//ThreadA: 사용자A 주문 금액 조회</span>\n  <span class=\"token keyword\">int</span> price <span class=\"token operator\">=</span> statefulService1<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">//ThreadA: 사용자A는 10000원을 기대했지만, 기대와 다르게 20000원 출력</span>\n  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"price = \"</span> <span class=\"token operator\">+</span> price<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>statefulService1<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">20000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">statefulService1</code>이든, <code class=\"language-text\">statefulService2</code>이든, 결국 같은 객체이다.</li>\n</ul>\n</li>\n<li>\n<p>실제로는 <u><strong>멀티쓰레드 환경</strong></u>이므로, 외부에서 <code class=\"language-text\">getPrice()</code>하는 것 뿐만 아니라 내부에서 같은 변수를 접근할 때에도 당연히 문제가 생긴다.</p>\n<ul>\n<li><u><strong>공유되는 필드인데, 특정 클라이언트가 값을 변경해버린다!!</strong></u></li>\n</ul>\n</li>\n<li>\n<p>실무에서 이런 경우를 종종 보는데, 이로인해 정말 해결하기 어려운 큰 문제들이 터진다.(몇년에 한번씩 꼭 만난다.)</p>\n</li>\n<li>\n<p>진짜 공유필드는 조심해야 한다! 스프링 빈은 항상 <code class=\"language-text\">무상태(stateless)</code>로 설계하자.</p>\n</li>\n<li>\n<p>해결?</p>\n<ul>\n<li>위 같은 경 그냥 <u><strong>order에서 금액을 리턴해서 지역변수로 사용</strong></u>하는 식으로 해야 한다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-code-classlanguage-textconfigurationcode과-싱글톤\" style=\"position:relative;\"><a href=\"#-code-classlanguage-textconfigurationcode%EA%B3%BC-%EC%8B%B1%EA%B8%80%ED%86%A4\" aria-label=\" code classlanguage textconfigurationcode과 싱글톤 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 <code class=\"language-text\">@Configuration</code>과 싱글톤</h2>\n<ul>\n<li>\n<p><code class=\"language-text\">AppConfig</code></p>\n<p>어라라?</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppConfig</span> <span class=\"token punctuation\">{</span>\n <span class=\"token annotation punctuation\">@Bean</span>\n <span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberService</span> <span class=\"token function\">memberService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MemberServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token annotation punctuation\">@Bean</span>\n <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderService</span> <span class=\"token function\">orderService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OrderServiceImpl</span><span class=\"token punctuation\">(</span>\n <span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token function\">discountPolicy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token annotation punctuation\">@Bean</span>\n <span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MemoryMemberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span>  </code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">memberService</code>빈을 만드는 코드를 보면 <code class=\"language-text\">memberRepository()</code> 를 호출한다. 이 메서드를 호출하면 <code class=\"language-text\">new MemoryMemberRepository()</code> 를 호출한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">orderService</code> 빈을 만드는 코드도 동일하게 <code class=\"language-text\">memberRepository()</code> 를 호출한다. 이 메서드를 호출하면 <code class=\"language-text\">new MemoryMemberRepository()</code> 를 호출한다.</p>\n</li>\n<li>\n<p>그럼 결론적으로 <code class=\"language-text\">Memory..</code>가 두 번 new 돼서 새롭게 생성돼서 싱글톤이 깨지지 않을까? 스프링은 어떻게 되는 걸까?</p>\n</li>\n<li>\n<p>테스트 코드</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">configurationTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">ApplicationContext</span> ac <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AppConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">MemberServiceImpl</span> memberService <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MemberServiceImpl</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">OrderServiceImpl</span> orderService <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderServiceImpl</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">MemoryMemberRepository</span> repository <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MemoryMemberRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>memberService<span class=\"token punctuation\">.</span><span class=\"token function\">getMemberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">isSameAs</span><span class=\"token punctuation\">(</span>orderService<span class=\"token punctuation\">.</span><span class=\"token function\">getMemberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>memberService<span class=\"token punctuation\">.</span><span class=\"token function\">getMemberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">isSameAs</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><u><strong>분명 다 같다! 어떻게 다 같지?</strong></u></li>\n</ul>\n</li>\n<li>\n<p>실험</p>\n<ul>\n<li>\n<p><code class=\"language-text\">AppConfig</code>에 생성될 때 출력문을 넣어보자.</p>\n<ul>\n<li>단축키: <code class=\"language-text\">soutm</code> 하면 함수 이름 출력해준다</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberRepository 생성\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MemoryMemberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberService</span> <span class=\"token function\">memberService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberService 생성\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MemberServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderService</span> <span class=\"token function\">orderService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orderService 생성\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OrderServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">discountPolicy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>결과 (순서는 보장되지 않음. 횟수만 보세용)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiklEQVQI1z2OWxaEMAhD3dLMWKvWFmjxvf/1ZA718UW4gUAj5wY+VoS5YFoK0q4Ic8aoGWHJVce1gA6FJ67c5qwORao3lGumDYQm7yeiLnCR0CWGZ4aL/PamOzIu+I0Jbno4oTVNXKvtfXxCw9uOoHqHCYYs9ZMn3BZ6ubh98PL7mHkW2LPg2yf8AUL6Z3rW3hGqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010182721390\"\n        title=\"image-20221010182721390\"\n        src=\"/static/c7fdaf70acead369621b3c149764d52a/37523/image-20221010182721390.png\"\n        srcset=\"/static/c7fdaf70acead369621b3c149764d52a/e9ff0/image-20221010182721390.png 180w,\n/static/c7fdaf70acead369621b3c149764d52a/f21e7/image-20221010182721390.png 360w,\n/static/c7fdaf70acead369621b3c149764d52a/37523/image-20221010182721390.png 720w,\n/static/c7fdaf70acead369621b3c149764d52a/302a4/image-20221010182721390.png 1080w,\n/static/c7fdaf70acead369621b3c149764d52a/d93d9/image-20221010182721390.png 1243w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p>이걸 어떻게 하는 걸까? 분명 자바 코드로 호출하는데…</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-code-classlanguage-textconfigurationcode과-바이트코드-조작의-마법\" style=\"position:relative;\"><a href=\"#-code-classlanguage-textconfigurationcode%EA%B3%BC-%EB%B0%94%EC%9D%B4%ED%8A%B8%EC%BD%94%EB%93%9C-%EC%A1%B0%EC%9E%91%EC%9D%98-%EB%A7%88%EB%B2%95\" aria-label=\" code classlanguage textconfigurationcode과 바이트코드 조작의 마법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 <code class=\"language-text\">@Configuration</code>과 바이트코드 조작의 마법</h2>\n<p>스프링 컨테이너는 <code class=\"language-text\">싱글톤 레지스트리</code>다. (싱글톤 객체를 생성하고 관리하는 기능) 따라서 스프링 빈이 싱글톤이 되도록 보장해주어야 한다. 그런데 스<u><strong>프링이 자바 코드까지 어떻게 하기는 어렵다.</strong></u> 저 자바 코드를 보면 분명 3번 호출되어야 하는 것이 맞다.</p>\n<ul>\n<li>\n<p>그래서 스프링은 <em><strong>클래스의 바이트코드를 조작</strong></em>하는 라이브러리를 사용한다.</p>\n</li>\n<li>\n<p>모든 비밀은 <code class=\"language-text\">@Configuration</code> 을 적용한 <code class=\"language-text\">AppConfig</code> 에 있다.</p>\n</li>\n<li>\n<p>스프링 컨테이너에 의해 생성된 <code class=\"language-text\">AppConfig</code> 빈을 출력해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">configurationDeep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">ApplicationContext</span> ac <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AppConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">AppConfig</span> bean <span class=\"token operator\">=</span> ac<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AppConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bean.getClass() = \"</span> <span class=\"token operator\">+</span> bean<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 644px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 3.3333333333333335%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAS0lEQVQI1x2LQQqAMAwEfZQHL0VNo01Da00Rwf8/ZKW5DczMxGKYF8IaCyg1BFIcuePUjrArNq5guSHlwWirfdDr9YazOcfU3I/nB7eqJRf/sBJ5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010184016955\"\n        title=\"image-20221010184016955\"\n        src=\"/static/01eae015b063e13cdef63052ea26ea10/78274/image-20221010184016955.png\"\n        srcset=\"/static/01eae015b063e13cdef63052ea26ea10/e9ff0/image-20221010184016955.png 180w,\n/static/01eae015b063e13cdef63052ea26ea10/f21e7/image-20221010184016955.png 360w,\n/static/01eae015b063e13cdef63052ea26ea10/78274/image-20221010184016955.png 644w\"\n        sizes=\"(max-width: 644px) 100vw, 644px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AppConfig 뒤에 무언가 더 붙어있다!</li>\n</ul>\n</li>\n</ul>\n<p>AppConfig 빈으로 등록된 객체는 사실 내가 만든 클래스가 아니다! 스프링이 CGLIB라는 바이트코드 조작 라이브러리를 사용해서 AppConfig 클래스를 상속받은 임의의 다른 클래스를 만들고, 그 다른 클래스를 스프링 빈으로 등록한 것이다!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWElEQVQoz42Tz46CMBDGeQgPPgrefB0vHjf7DHty32Ozb6EngyReEOoFFEX8ix5oC3ybrwmsGkOcZNJpKb/5ptNaZVmiKIqXzm9aa0gpoZRCnudYLBbwPA+z2Qy+7yPLsmYP3UKLEZimKU6nk/Hj8YjNZoMkScy43W5xOBzM+vl8RhiGsKjkHsBsVVWZOVUR9K4xicUMQggsl0vEcWyyEfQMZJKyKqEL3QAYc60WYICUOp/PMZ1OzQIBr4BUX5sqFKSWD5U1QJNJa3MutZLmx6eSVakw/B2i992DPbIx+Bkgk9ljyZfLxRzsarVqDr7OSCDnJpYKcRqjP+qj+9lF56MD+8tGsA6gcvUPZPtZsuM4cF3XxHWj7oGsQAQC+2SPsTPGxJ0g8AIIXyCMwkeF1+vV3CeOt9vtpcJ3jE1tvYcEsmnvGquw2l4JgVEUYbfbmc1tzgfAV/QHGJBCsfJYxMgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221010184409772\"\n        title=\"image-20221010184409772\"\n        src=\"/static/f6ab0de2e9eb49016d071525bedfcf78/37523/image-20221010184409772.png\"\n        srcset=\"/static/f6ab0de2e9eb49016d071525bedfcf78/e9ff0/image-20221010184409772.png 180w,\n/static/f6ab0de2e9eb49016d071525bedfcf78/f21e7/image-20221010184409772.png 360w,\n/static/f6ab0de2e9eb49016d071525bedfcf78/37523/image-20221010184409772.png 720w,\n/static/f6ab0de2e9eb49016d071525bedfcf78/302a4/image-20221010184409772.png 1080w,\n/static/f6ab0de2e9eb49016d071525bedfcf78/07a9c/image-20221010184409772.png 1440w,\n/static/f6ab0de2e9eb49016d071525bedfcf78/e2cbf/image-20221010184409772.png 2138w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그 임의의 다른 클래스가 바로 싱글톤이 보장되도록 해준다. 아마도 다음과 같이 바이트 코드를 조작해서 작성되어 있을 것이다.(실제로는 CGLIB의 내부 기술을 사용하는데 매우 복잡하다.) -> 나중에 AOP 같은 곳에도 이런 메커니즘이 적용되어 있다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">AppConfig@CGLIB 예상 코드</code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token function\">memberRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>memoryMemberRepository가 이미 스프링 컨테이너에 등록되어 있으면<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> 스프링 컨테이너에서 찾아서 반환<span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">//스프링 컨테이너에 없으면</span>\n 기존 로직을 호출해서 <span class=\"token class-name\">MemoryMemberRepository</span>를 생성하고 스프링 컨테이너에 등록\n <span class=\"token keyword\">return</span> 반환\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>@Bean이 붙은 메서드마다 이미 스프링 빈이 존재하면 존재하는 빈을 반환하고, 없으면 생성해서 스프링 빈으로 등록하고 반환하는 코드가 동적으로 만들어진다.</p>\n</li>\n<li>\n<p>덕분에 싱글톤이 보장!</p>\n</li>\n<li>\n<h3 id=\"code-classlanguage-textconfigurationcode-을-적용하지-않고-code-classlanguage-textbeancode-만-적용하면\" style=\"position:relative;\"><a href=\"#code-classlanguage-textconfigurationcode-%EC%9D%84-%EC%A0%81%EC%9A%A9%ED%95%98%EC%A7%80-%EC%95%8A%EA%B3%A0-code-classlanguage-textbeancode-%EB%A7%8C-%EC%A0%81%EC%9A%A9%ED%95%98%EB%A9%B4\" aria-label=\"code classlanguage textconfigurationcode 을 적용하지 않고 code classlanguage textbeancode 만 적용하면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">@Configuration</code> 을 적용하지 않고, <code class=\"language-text\">@Bean</code> 만 적용하면?</h3>\n<p><code class=\"language-text\">@Configuration</code>을 붙이면 바이트코드를 고작해서 자식 객체를 만든다는데, 그럼 <code class=\"language-text\">@Configuration</code>이 없으면 여러번 스프링빈으로 등록할까?</p>\n<ul>\n<li>\n<p>스프링 빈 등록은 정상적으로 되지만, 여러 번 객체를 생성한다. <code class=\"language-text\">MemberService</code>를 생성할 때 <code class=\"language-text\">MemberRepository</code>를 새로 생성하고 넣어주고, <code class=\"language-text\">OrderService</code>를 생성할 때 <code class=\"language-text\">MemberRepository</code>를 새로 생성하고 넣어준다.</p>\n<ul>\n<li>그리고 이렇게 넣어준 <code class=\"language-text\">MemberRepository</code>는 스프링 빈이 아니다. 그냥 클래스에서 new 해서 넣어준 것과 다를 바가 없다.</li>\n<li>CGB는 <u><strong>이미 등록된 스프링 빈이면 스프링 컨테이너에서 찾아서 넣어주는 로직</strong></u>이 있기 때문이다.</li>\n</ul>\n</li>\n<li>\n<p>따라서 <code class=\"language-text\">MemberService</code>에 등록된 <code class=\"language-text\">MemberRepository</code>와  <code class=\"language-text\">OrderService</code>에 등록된 <code class=\"language-text\">MemberRepository</code>가 달라진다! (새로 생성한 <code class=\"language-text\">MemberRepository</code>도 역시 다르다.)</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-정리\" style=\"position:relative;\"><a href=\"#-%EC%A0%95%EB%A6%AC\" aria-label=\" 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 정리</h2>\n<ul>\n<li><code class=\"language-text\">@Bean</code>만 사용해도 스프링 빈으로 등록되지만, 싱글톤을 보장하지 않는다.\n<ul>\n<li><code class=\"language-text\">memberRepository()</code> 처럼 의존관계 주입이 필요해서 메서드를 직접 호출할 때 <u><strong>컨테이너에 등록되면 찾아서 넣어주는 로직이 없어지므로</strong></u> 싱글톤을 보장하지 않는다.</li>\n</ul>\n</li>\n<li>크게 고민할 것이 없다. 스프링 설정 정보는 항상 <code class=\"language-text\">@Configuration</code> 을 사용하자.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-%EC%8B%B1%EA%B8%80%ED%86%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88\">☘️ 싱글톤 컨테이너</a></p>\n<ul>\n<li>\n<p><a href=\"#-%EC%9B%B9-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EA%B3%BC-%EC%8B%B1%EA%B8%80%ED%86%A4\">📌 웹 애플리케이션과 싱글톤</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%8B%B1%EA%B8%80%ED%86%A4-%ED%8C%A8%ED%84%B4\">📌 싱글톤 패턴</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%8B%B1%EA%B8%80%ED%86%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88\">📌 싱글톤 컨테이너 (스프링 컨테이너)</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%8B%B1%EA%B8%80%ED%86%A4-%EB%B0%A9%EC%8B%9D%EC%9D%98-%EC%A3%BC%EC%9D%98%EC%A0%90-\">📌 싱글톤 방식의 주의점 ✨</a></p>\n<ul>\n<li><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B9%88%EC%9D%80-%ED%95%AD%EC%83%81-%EB%AC%B4%EC%83%81%ED%83%9Cstateless%EB%A1%9C-%EC%84%A4%EA%B3%84%ED%95%98%EA%B8%B0\">스프링 빈은 항상 <code class=\"language-text\">무상태(stateless)</code>로 설계하기!</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-configuration%EA%B3%BC-%EC%8B%B1%EA%B8%80%ED%86%A4\">📌 <code class=\"language-text\">@Configuration</code>과 싱글톤</a></p>\n</li>\n<li>\n<p><a href=\"#-configuration%EA%B3%BC-%EB%B0%94%EC%9D%B4%ED%8A%B8%EC%BD%94%EB%93%9C-%EC%A1%B0%EC%9E%91%EC%9D%98-%EB%A7%88%EB%B2%95\">📌 <code class=\"language-text\">@Configuration</code>과 바이트코드 조작의 마법</a></p>\n</li>\n<li>\n<p><a href=\"#-%EC%A0%95%EB%A6%AC\">📌 정리</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"October 10, 2022","title":"싱글톤 컨테이너 - 스프링 핵심 원리 기본편 05","categories":"강의","author":"goldggyul","emoji":null,"imageEmoji":"spring-logo.png"},"fields":{"slug":"/spring-core-basic-005/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://goldggyul.github.io","comments":{"utterances":{"repo":"goldggyul/goldggyul.github.io"}}}}},"pageContext":{"slug":"/spring-core-basic-006/","nextSlug":"/spring-core-basic-005/","prevSlug":""}},"staticQueryHashes":["1956554647","2938748437","3350743975","3454833782"]}