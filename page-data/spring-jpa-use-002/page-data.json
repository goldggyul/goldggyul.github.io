{"componentChunkName":"component---src-templates-blog-template-js","path":"/spring-jpa-use-002/","result":{"data":{"cur":{"id":"9f7746b6-6b98-51a9-97ee-c240e1dccee9","html":"<blockquote>\n<p>본 게시글은 <a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/\">실전! 스프링 부트와 JPA 활용1</a> 강의를 듣고 정리했습니다.</p>\n</blockquote>\n<h1 id=\"️-도메인-분석-설계\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%B6%84%EC%84%9D-%EC%84%A4%EA%B3%84\" aria-label=\"️ 도메인 분석 설계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>☘️ 도메인 분석 설계</h1>\n<h2 id=\"-요구사항-분석\" style=\"position:relative;\"><a href=\"#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D\" aria-label=\" 요구사항 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 요구사항 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZUlEQVQ4y5WUTU8TURSG+QkmLty4ceeP0MREo2GBMdHExBj/hwv8KlYBQTAE/KAqrURRUuKqESSoUFopINCE1Hag0DpOO98zd27LsHnNvQNkWlHK4s2dOfOeJ+fMzDlNruuCOBTEqdSJwiIObEJhO9Q7iePFmJ/6vLTCY5XqFppodQuirOG3rPukQVIMaBaFahIohg3FJNAsB7pNUdZM7tnzKzrEsgbDJmhiVEnRUVINT4rOE4qSjK/xJOYWl/EjvYr5pTSmkylMTc8iI+Qh61ZNHoOatuNV6H8g+YDx7/OYTsxxJVKL/H5qJoH1gsg9NUD5H8BdKDtlw0ZZt7AplrhYXDHIX7D/Atm7Ye9p8lsCrYEOBNp7EOjoxZ1gNx509eHW/UeIjES5h3kbAmomwWxqCb0DIfQPhjEQiqDv+Ws8DUXQ0z+Ij7HP/AM1BNxtmSWQqguLVnmMtcmqItVtmE71sC07+DKTROu9IIKdjxF42IW7wU60tXfz2PD7Q7QsllXYFReRd6M4dbYZl65ex/mWyzhzoQUXr1zD6XPNuHm7jVfPvAcCd6+lsoKNtTzWc2vIZrLIZXIQsgKPiaJU4z0QqKgG0qKMDz8LGMsVMZbZQHQ1j2i2gNFsEfFNCYrWIFBUdFDTxpOFDI6GYzg5Monjb8ZxLPIJJ95O4MhQDDcmUtzzS94HWNmnQlUzsVAo4cVyDq9WBITTAobSAl6uCHi2lMW4UIRWPyl7o1fZ8gZd8Q26rEFVDVDTgmPUilVm6Ka3UHZyJP9ycN1tWGxV+cRWkUko/310UifbgbGz0vx+i3jr6w+pAoA7cEtV5wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012164832688\"\n        title=\"image-20221012164832688\"\n        src=\"/static/0400432fe6d2b1aba24570d5ebffa378/37523/image-20221012164832688.png\"\n        srcset=\"/static/0400432fe6d2b1aba24570d5ebffa378/e9ff0/image-20221012164832688.png 180w,\n/static/0400432fe6d2b1aba24570d5ebffa378/f21e7/image-20221012164832688.png 360w,\n/static/0400432fe6d2b1aba24570d5ebffa378/37523/image-20221012164832688.png 720w,\n/static/0400432fe6d2b1aba24570d5ebffa378/302a4/image-20221012164832688.png 1080w,\n/static/0400432fe6d2b1aba24570d5ebffa378/07a9c/image-20221012164832688.png 1440w,\n/static/0400432fe6d2b1aba24570d5ebffa378/6fa81/image-20221012164832688.png 1856w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>기능 목록\n<ul>\n<li>회원 기능\n<ul>\n<li>회원 등록</li>\n<li>회원 조회</li>\n</ul>\n</li>\n<li>상품 기능\n<ul>\n<li>상품 등록</li>\n<li>상품 수정</li>\n<li>상품 조회</li>\n</ul>\n</li>\n<li>주문 기능\n<ul>\n<li>상품 주문</li>\n<li>주문 내역 조회</li>\n<li>주문 취소</li>\n</ul>\n</li>\n<li>기타 요구사항\n<ul>\n<li>상품은 재고 관리가 필요하다. (구매하면 수량 빼고, 주문 취소하면 다시 수량 원복하고..)</li>\n<li>상품의 종류는 도서, 음반, 영화가 있다.</li>\n<li>상품을 카테고리로 구분할 수 있다.</li>\n<li>상품 주문시 배송 정보를 입력할 수 있다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-도메인-모델과-테이블-설계\" style=\"position:relative;\"><a href=\"#-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%AA%A8%EB%8D%B8%EA%B3%BC-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%84%A4%EA%B3%84\" aria-label=\" 도메인 모델과 테이블 설계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 도메인 모델과 테이블 설계</h2>\n<h3 id=\"도메인-모델-큰그림\" style=\"position:relative;\"><a href=\"#%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%AA%A8%EB%8D%B8-%ED%81%B0%EA%B7%B8%EB%A6%BC\" aria-label=\"도메인 모델 큰그림 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>도메인 모델 (큰그림)</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABE0lEQVQoz4VSyaqEMBDM/3+QB+9eFNyQQU9uIAju+95DBRIchfcCZTr2VpUOW5aF2rblgH2e558Yx5HquqamaWiaph/fcRzEqqoiz/PIdV2CjXVdl9zvwEqShHRdJ8uyKMuyVzzDZxgGWey/hXioQc6zmSzYdR2XsK4rB6Rjh6R5njmED0AsciDzxbAoCi4XSNOU+r7nCMOQS9M0jYIg4Izw3/d9UhSFVFXl8l8F0QXdyrL8kYYLBhuw2/dd/of9+Xx4E8Hwfh0MBpLQ/T6IZyCSt22TrwHTho3GgJg0AzPHcci2bcnyXhSTBCMgiiKK45hM05RnwDAMfhV5nhMT71AM5fnuMBjhhxKcYQumwo9rg/8L52G0OyFzmEYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012165912645\"\n        title=\"image-20221012165912645\"\n        src=\"/static/1c2b4894b050f1ebae4318d3626c584a/37523/image-20221012165912645.png\"\n        srcset=\"/static/1c2b4894b050f1ebae4318d3626c584a/e9ff0/image-20221012165912645.png 180w,\n/static/1c2b4894b050f1ebae4318d3626c584a/f21e7/image-20221012165912645.png 360w,\n/static/1c2b4894b050f1ebae4318d3626c584a/37523/image-20221012165912645.png 720w,\n/static/1c2b4894b050f1ebae4318d3626c584a/302a4/image-20221012165912645.png 1080w,\n/static/1c2b4894b050f1ebae4318d3626c584a/07a9c/image-20221012165912645.png 1440w,\n/static/1c2b4894b050f1ebae4318d3626c584a/26162/image-20221012165912645.png 2020w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><u><strong>회원, 주문, 상품</strong></u>의 관계: 우선 회원은 여러 주문을 할 수 있다. 그리고 한 주문에 여러 상품이 가능하고, 상품도 여러 주문에 들어갈 수 있으므로 주문과 상품은 다대다 관계다. 하지만 이런 다대다 관계는 관계형 데이터베이스는 물론이고 엔티 티에서도 거의 사용하지 않는다. 따라서 그림처럼 주문상품이라는 엔티티를 추가해서 다대다 관계를 일대 다, 다대일 관계로 풀어냈다. (즉 관계를 나타내는 엔티티 추가)</li>\n<li><strong>상품 분류</strong>: 상품은 도서, 음반, 영화로 구분되는데 상품이라는 공통 속성을 사용하므로 상속 구조로 표현했 다.</li>\n</ul>\n<h3 id=\"회원-엔티티-분석-실제\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90-%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%B6%84%EC%84%9D-%EC%8B%A4%EC%A0%9C\" aria-label=\"회원 엔티티 분석 실제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원 엔티티 분석 (실제)</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABs0lEQVQ4y32T54rDQAyE/f4vlV9JIJDee++998zxCWScOzjBYnulHc2M1sH9ftd+v1e/31er1dJut9P5fNbn89H7/f6z2L9cLlqv16rVahqPxzqdTnq9XrYCAOv1uiqVijqdjjabjTUgOBwN/14ul1a7WCwMbLvdGhj54Pl8Kp/Pq9FoqNlsajKZfAH+XgQ1sVhMpVJJo9FIh8PBAFEQ8HK9XnU8Hk3u4/EQTf5jCCNIlMtlk8w5t8gACYBIRJn5Ow1cUrQJXkbDAAGZTqcaDofWEX8w3A/3ej0Vi0WzAxUET86w5wwJGwr6E4mEScjlcuYPB/ARw7PZrAqFgg0BqbfbzXxrt9uWhz3PkCEHk8mkMpmMUqmUFVPA9OnI9LlOq9UqZAgjWJPjuvm+MWQg0GZxEEAvIFDAAgR2zqTb7Vo9sp2hAZL0D+5g1GDk+PSi4UNinydqQslImc1m5gn3Cp/YwwqGlE6nNZ/PQ1CGxJ1lr1qtWi1MWUw9IAEQXrh/JJg6PtGAqcMEZvhMLZ4zxMFgoHg8bs1RGHAAdBL8gjAlgWfsAwZb/4+Rx53FT57+TjPWDxm+26NRSnBlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012171949466\"\n        title=\"image-20221012171949466\"\n        src=\"/static/1ba07f0cecde621d52a40ff25b4d2dc7/37523/image-20221012171949466.png\"\n        srcset=\"/static/1ba07f0cecde621d52a40ff25b4d2dc7/e9ff0/image-20221012171949466.png 180w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/f21e7/image-20221012171949466.png 360w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/37523/image-20221012171949466.png 720w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/302a4/image-20221012171949466.png 1080w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/07a9c/image-20221012171949466.png 1440w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/a01dc/image-20221012171949466.png 2006w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>우선 공통 속성으로  pk로 id가 있다. generate해주는 값.</li>\n<li>회원에 임베디드 타입으로 Address 타입이 있다. (<u><strong>기본편에 값타입</strong></u>. Value Type을 보세요)</li>\n<li>주문별 상품을 여러개 살 수 있어서 수량도 확인해야 하고, 후에 상품의 가격이 바뀔 수도 있으니까 그 때 가격도 추가해야 한다.</li>\n<li>Order의 status로 주문/취소 상태를 나타낸다.</li>\n<li>카테고리(Category): 상품과 다대다 관계를 맺는다. parent , child 로 부모, 자식 카테고리를 연결한다.</li>\n<li>주소(Address): <u><strong>값 타입(임베디드 타입)</strong></u>이다. 회원과 배송(Delivery)에서 사용한다</li>\n</ul>\n<blockquote>\n<p>다대다 관계가 있긴 하지만, 운영에선 쓰면 안된다. 그런 것도 일대다, 다대일로 풀어내야 한다. (기본편 참고)</p>\n<p>그리고 이 경우에 Member도  order를 가지고, Order도 member를 가진다. 가급적이면 양방향 연관관계를 쓰지 말고, 단방향 연관관계를 쓰는 것이 좋다.</p>\n<p>그런데 예제니까 다양한 연관관계를 써보자!</p>\n<blockquote>\n<p>참고: 회원이 주문을 하기 때문에, 회원이 주문리스트를 가지는 것은 얼핏 보면 잘 설계한 것 같지만, 객체 세상은 실제 세계와는 다르다. 실무에서는 회원이 주문을 참조하지 않고, 주문이 회원을 참조하는 것으로 충분 하다. 여기서는 일대다, 다대일의 양방향 연관관계를 설명하기 위해서 추가했다.</p>\n</blockquote>\n<p>객체 지향을 처음 공부하면서 많이 실수하는 건, Member와 Order가 있을 때 ‘회원이 주문을 하니까 회원에 Order 리스트를 두면 되겠구나.‘라고 생각하는데, 시스템에서는 Member를 통해 Order가 일어난다고만 생각하는 게 아니고, 두 객체를 동급으로 보고 생각해야 한다.</p>\n<p>➡️ <u><strong>주문을 생성할 때 회원이 필요하다고 생각해라.</strong></u></p>\n<p>생각해보면 Order에 쿼리할 때도, 주문 내역이 필요하면 Member를 찾고 그 안에 주문 리스트를 찾아오는 게 아니고, Order에서 필터링 조건에 멤버가 들어갈 뿐이다.</p>\n<p>따라서 사실상 Member에서 Order로의 1대 다 collection(리스트?)는 필요가 없다.</p>\n</blockquote>\n<h3 id=\"회원-테이블-분석\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90-%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%B6%84%EC%84%9D\" aria-label=\"회원 테이블 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원 테이블 분석</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.1111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2klEQVQ4y42Uh4oCQRBE9/9/S0QQc8KAOeecQx+voI9Fzj0bRted6eqq6naCx+NhHq/Xy57P57+Lc+RNJhMbj8f6TbAX8HA6nWyz2fxuRIWfabfblkgkLJPJWLfbtd1uZ/v93oLz+WzpdNpisZj1ej0Br9dru9/vvwDh5VGpVCyZTFqn07FWq2Wz2cxWq5UFfORyOb2A6e12UyWe3wGJ7XZr/X5frAAbDAYicDgclCvAbDarKpfLxWBM0idAzlCw0WiISLlcVgFAyQk4gLHD4VAmIxlADI6SDMNms2n1el0syQU0CBse7ni4AeHwQjShVCpZrVYTGcAkGRA2j8ej5DqIf1+vV1sul2KNGg88xyrAyJ3P59qXh6lUSpU4BCgGO1vGg9EoFovyjT0Cifl8XsUA9IIBnYrH40rCYPcCLzHf3wM4Go1sOp2qKL4xNpwHCJUChDLUYQht5o8EDsCGTsIEpsjnDPuAQ8ZtoMMChAkDTSUWEpDugw0jkpHEHoUIJqNQKCiH8B6oKTSADnkHo7ocboozp5BLD5CFP8imKpVcxvsMvs9ieJT8YhFDqLOQRrXFYhEJ+KmAAPGqWq1q6n1U8Ombm+cvpgLkv8iMIRlv/Cr75m4MLwj9AMAKFza8JX+HAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012173255580\"\n        title=\"image-20221012173255580\"\n        src=\"/static/7dadd2bc0943c5fe22afa7a5672f3db8/37523/image-20221012173255580.png\"\n        srcset=\"/static/7dadd2bc0943c5fe22afa7a5672f3db8/e9ff0/image-20221012173255580.png 180w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/f21e7/image-20221012173255580.png 360w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/37523/image-20221012173255580.png 720w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/302a4/image-20221012173255580.png 1080w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/07a9c/image-20221012173255580.png 1440w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/09b15/image-20221012173255580.png 1704w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>MEMBER: CITY, STREET, ZIPCODE를 보면 <u><strong>value type 값(임베디드 타입 정보)이 그대로 필드</strong></u>로 내려온 걸 볼 수 있다.</p>\n<ul>\n<li>DELIVERY 테이블도 마찬가지</li>\n</ul>\n</li>\n<li>\n<p>엔티티를 보면 <u><strong>아이템을 상속받는 게 여러개(앨범, 도서, 영화 타입)인데, 테이블을 보면 ITEM 테이블이 하나</strong></u>다.</p>\n<ul>\n<li><u><strong>기본편에서 상속 관계 매핑 3가지 방법 중 가장 단순한 싱글 테이블 전략</strong></u>(한 테이블에 다 때려박고, DTYPE으로 구분해서 사용)을 사용했다.</li>\n<li>그래서 도서인 경우 author, isbn이 있고 영화인 경우 director, actor가 있지만 일단 다 때려박게 된다. 그래서 단점이지만 일반적으로 성능이 잘 나온다.</li>\n</ul>\n</li>\n<li>\n<p>주문 테이블이 ORDER가 아니고 ORDERS인 이유는 db에 ORDER BY 예약어 때문에 관례상 ORDERS로 많이 쓴다.</p>\n</li>\n<li>\n<p>category와 item을 보면, 엔티티에서는 카테고리가 아이템을 List로 가지고, 아이템도 카테고리를 List로 가져서 Collectio을 갖고 다대다를 만들 수 있지만, 관계형 데이터베이스에서는 일반적인 설계로는 다대다를 만들 수 없다. 그래서 매핑 테이블(CATEGORY_ITEM)을 둬야 한다. (맨날 하던.. 다대다는 테이블로 관계 나타내기 말하는 것)</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>참고: 실제 코드에서는 DB에 <u>소문자 + _(언더스코어) 스타일</u>을 사용하겠다.</strong></p>\n<p>데이터베이스 테이블명, 컬럼명에 대한 관례는 회사마다 다르다. 보통은 <u><strong>대문자 + _(언더스코어)나 소문자 + _(언더스코어) 방식 중에 하나</strong></u>를 지정해서 <u><strong>일관성</strong></u> 있게 사용한다. 강의에서 설명할 때는 객체와 차이를 나타내기 위해 데이터베이스 테이블, 컬럼명은 대문자를 사용했지만, 실제 코드에서는 <code class=\"language-text\">소문자 + _(언더스코어)</code> 스타일을 사용하겠다.</p>\n</blockquote>\n<h3 id=\"연관관계-매핑-분석-\" style=\"position:relative;\"><a href=\"#%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EB%B6%84%EC%84%9D-\" aria-label=\"연관관계 매핑 분석  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>연관관계 매핑 분석 ✨✨✨</h3>\n<table>\n<thead>\n<tr>\n<th><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABs0lEQVQ4y32T54rDQAyE/f4vlV9JIJDee++998zxCWScOzjBYnulHc2M1sH9ftd+v1e/31er1dJut9P5fNbn89H7/f6z2L9cLlqv16rVahqPxzqdTnq9XrYCAOv1uiqVijqdjjabjTUgOBwN/14ul1a7WCwMbLvdGhj54Pl8Kp/Pq9FoqNlsajKZfAH+XgQ1sVhMpVJJo9FIh8PBAFEQ8HK9XnU8Hk3u4/EQTf5jCCNIlMtlk8w5t8gACYBIRJn5Ow1cUrQJXkbDAAGZTqcaDofWEX8w3A/3ej0Vi0WzAxUET86w5wwJGwr6E4mEScjlcuYPB/ARw7PZrAqFgg0BqbfbzXxrt9uWhz3PkCEHk8mkMpmMUqmUFVPA9OnI9LlOq9UqZAgjWJPjuvm+MWQg0GZxEEAvIFDAAgR2zqTb7Vo9sp2hAZL0D+5g1GDk+PSi4UNinydqQslImc1m5gn3Cp/YwwqGlE6nNZ/PQ1CGxJ1lr1qtWi1MWUw9IAEQXrh/JJg6PtGAqcMEZvhMLZ4zxMFgoHg8bs1RGHAAdBL8gjAlgWfsAwZb/4+Rx53FT57+TjPWDxm+26NRSnBlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012171949466\"\n        title=\"image-20221012171949466\"\n        src=\"/static/1ba07f0cecde621d52a40ff25b4d2dc7/37523/image-20221012171949466.png\"\n        srcset=\"/static/1ba07f0cecde621d52a40ff25b4d2dc7/e9ff0/image-20221012171949466.png 180w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/f21e7/image-20221012171949466.png 360w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/37523/image-20221012171949466.png 720w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/302a4/image-20221012171949466.png 1080w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/07a9c/image-20221012171949466.png 1440w,\n/static/1ba07f0cecde621d52a40ff25b4d2dc7/a01dc/image-20221012171949466.png 2006w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></th>\n<th><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.1111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2klEQVQ4y42Uh4oCQRBE9/9/S0QQc8KAOeecQx+voI9Fzj0bRted6eqq6naCx+NhHq/Xy57P57+Lc+RNJhMbj8f6TbAX8HA6nWyz2fxuRIWfabfblkgkLJPJWLfbtd1uZ/v93oLz+WzpdNpisZj1ej0Br9dru9/vvwDh5VGpVCyZTFqn07FWq2Wz2cxWq5UFfORyOb2A6e12UyWe3wGJ7XZr/X5frAAbDAYicDgclCvAbDarKpfLxWBM0idAzlCw0WiISLlcVgFAyQk4gLHD4VAmIxlADI6SDMNms2n1el0syQU0CBse7ni4AeHwQjShVCpZrVYTGcAkGRA2j8ej5DqIf1+vV1sul2KNGg88xyrAyJ3P59qXh6lUSpU4BCgGO1vGg9EoFovyjT0Cifl8XsUA9IIBnYrH40rCYPcCLzHf3wM4Go1sOp2qKL4xNpwHCJUChDLUYQht5o8EDsCGTsIEpsjnDPuAQ8ZtoMMChAkDTSUWEpDugw0jkpHEHoUIJqNQKCiH8B6oKTSADnkHo7ocboozp5BLD5CFP8imKpVcxvsMvs9ieJT8YhFDqLOQRrXFYhEJ+KmAAPGqWq1q6n1U8Ombm+cvpgLkv8iMIRlv/Cr75m4MLwj9AMAKFza8JX+HAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012173255580\"\n        title=\"image-20221012173255580\"\n        src=\"/static/7dadd2bc0943c5fe22afa7a5672f3db8/37523/image-20221012173255580.png\"\n        srcset=\"/static/7dadd2bc0943c5fe22afa7a5672f3db8/e9ff0/image-20221012173255580.png 180w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/f21e7/image-20221012173255580.png 360w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/37523/image-20221012173255580.png 720w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/302a4/image-20221012173255580.png 1080w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/07a9c/image-20221012173255580.png 1440w,\n/static/7dadd2bc0943c5fe22afa7a5672f3db8/09b15/image-20221012173255580.png 1704w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></th>\n</tr>\n</thead>\n</table>\n<ul>\n<li><strong>회원과 주문</strong>: 일대다, 다대일의 양방향 관계다. 따라서 <u><strong>연관관계의 주인</strong></u>을 정해야 하는데, <u><strong>외래 키가 있는</strong></u> 주문을 연관관계의 주인으로 정하는 것이 좋다. 그러므로 <code class=\"language-text\">Order.member</code> 를 <code class=\"language-text\">ORDERS.MEMBER_ID</code> 외래 키와 매핑한다.\n<ul>\n<li>(엔티티를 보면 Member도 있고 Order.member도 있으니 어느 쪽을 주인으로 할 지를 말하는 것 같다.)</li>\n<li><u><strong>연관관계의 주인 정해야함</strong></u> ✨✨✨: 외래키가 가까운 곳에 있는 걸 연관관계의 주인으로 잡는다. 그래야 모든 게 편하다!</li>\n<li>일대다 관계에선 무조건 다쪽에 외래키가 존재한다. 따라서 Order의 member가 연관관계의 주인이 되고, Member는 mapsBy로 연관관계의 거울(단순하게 읽기만 하는)이 된다.\n<ul>\n<li><u><strong>연관관계의 주인 쪽에 값을 세팅해야 실제로 변경된다!</strong></u></li>\n<li>반대쪽은 단순하게 조회용으로만 쓴다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>주문상품과 주문</strong>: 다대일 양방향 관계다. 외래 키가 주문상품에 있으므로 주문상품이 연관관계의 주인이다. 그러므로 <code class=\"language-text\">OrderItem.order</code> 를 <code class=\"language-text\">ORDER_ITEM.ORDER_ID</code> 외래 키와 매핑한다.\n<ul>\n<li>(<code class=\"language-text\">Order</code>를 맵핑할지, <code class=\"language-text\">OrderItem의 order</code>를 매핑할지?)</li>\n</ul>\n</li>\n<li><strong>주문상품과 상품</strong>: 다대일 단방향 관계다. <code class=\"language-text\">OrderItem.item</code> 을 <code class=\"language-text\">ORDER_ITEM.ITEM_ID</code> 외래 키와 매핑한다.\n<ul>\n<li>다이어그램을 보면 OrderItem에서 Item으로 화살표가 있다. OrderItem만 Item을 보는 단방향 관계라는 의미이다.</li>\n<li>단방향 관계이므로 OrderItem.item만 잘 매핑하면 된다.</li>\n</ul>\n</li>\n<li><strong>주문과 배송</strong>: 일대일 양방향 관계다. Order.delivery 를 ORDERS.DELIVERY_ID 외래 키와 매핑한다.\n<ul>\n<li>일대일 관계는 외래키를 둘 중 어디에 두더라도 상관이 없다. 근데 지금은 ORDERS에 외래키가 있으므로, Order에 있는 delivery가 연관관계의 주인이 된다.</li>\n</ul>\n</li>\n<li><strong>카테고리와 상품</strong>: <code class=\"language-text\">@ManyToMany</code> 를 사용해서 매핑한다.(실무에서 @ManyToMany는 사용하지 말자. 여기서는 다대다 관계를 예제로 보여주기 위해 추가했을 뿐이다)</li>\n</ul>\n<blockquote>\n<p><strong>참고: 외래 키가 있는 곳을 연관관계의 주인으로 정해라.</strong> ✨✨✨</p>\n<p>연관관계의 주인은 단순히 외래 키를 누가 관리하냐의 문제이지 비즈니스상 우위에 있다고 주인으로 정하면 안된다.. 예를 들어서 자동차와 바퀴가 있으면, 일대다 관계에서 항상 다쪽에 외래 키가 있으므로 외래 키가 있는 바퀴를 연관관계의 주인으로 정하면 된다. 물론 자동차를 연관관계의 주인으로 정하는 것이 불가능 한 것은 아니지만, <u><strong>자동차를 연관관계의 주인으로 정하면 자동차가 관리하지 않는 바퀴 테이블의 외래 키 값이 업데이트 되므로 관리와 유지보수가 어렵고, 추가적으로 별도의 업데이트 쿼리가 발생하는 성능 문제</strong></u>도 있 다. 자세한 내용은 JPA 기본편을 참고하자.</p>\n</blockquote>\n<h2 id=\"-엔티티-클래스-개발\" style=\"position:relative;\"><a href=\"#-%EC%97%94%ED%8B%B0%ED%8B%B0-%ED%81%B4%EB%9E%98%EC%8A%A4-%EA%B0%9C%EB%B0%9C\" aria-label=\" 엔티티 클래스 개발 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 엔티티 클래스 개발</h2>\n<ul>\n<li>\n<p>예제에서는 설명을 쉽게하기 위해 엔티티 클래스에 Getter, Setter를 모두 열고, 최대한 단순하게 설계</p>\n</li>\n<li>\n<p>실무에서는 가급적 <u><strong>Getter는 열어두고, Setter는 꼭 필요한 경우에만</strong></u> 사용하는 것을 추천</p>\n<blockquote>\n<p>참고: 이론적으로 Getter, Setter 모두 제공하지 않고, 꼭 필요한 별도의 메서드를 제공하는게 가장 이상적이다. 하지만 실무에서 <u><strong>엔티티의 데이터는 조회할 일이 너무 많으므로</strong></u>, Getter의 경우 모두 열어두는 것이 편리하다. Getter는 아무리 호출해도 호출 하는 것 만으로 어떤 일이 발생하지는 않는다. 하지만 Setter는 문제가 다르다. <u><strong>Setter를 호출하면 데이터가 변한다</strong></u>. Setter를 막 열어두면 가까운 미래에 엔티티가 도대체 왜 변경되는지 추적하기 점점 힘들어진다. 그래서 <u><strong>엔티티를 변경할 때는 Setter 대신에 변경 지점이 명확하도록 변경을 위한 비즈니스 메서드를 별도로 제공</strong></u>해야 한다. 그래야 유지 보수가 편해진다.</p>\n</blockquote>\n</li>\n<li>\n<p>domain 패키지에 핵심 엔티티들을 만들자.</p>\n</li>\n</ul>\n<h3 id=\"code-classlanguage-textmembercode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textmembercode\" aria-label=\"code classlanguage textmembercode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">Member</code></h3>\n<ul>\n<li>\n<p>엔티티 분석한 대로 만들자.</p>\n</li>\n<li>\n<p>pk로 id를 <code class=\"language-text\">@GeneratedValue</code> 디폴트로 설정했으므로 알아서 시퀀스값 등을 사용해줄 것이다.</p>\n<ul>\n<li>column에 그냥 id로 두는 스타일도 있고, order_id로 두는 스타일도 있는데, 테이블명을 붙이고 order_id로 하는 걸 선호한다. 자세한 건 뒤에서 더 설명…</li>\n</ul>\n<blockquote>\n<p>참고: 엔티티(객체)는 타입(여기서는 Member)이 있으므로 id 필드만으로 쉽게 구분할 수 있다.(Member.id) 하지만 <u><strong>테이블은 타입이 없으므로 구분이 어렵다.</strong></u> 그리고 join할 때도 좀 불편하다.</p>\n<p>따라서 테이블은 관례상 테이블명 + id 를 많이 사용한다. 참고로 객체에서 id 대신에 memberId 를 사용해도 된다. 중요한 것은 일관성이다.</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">Address</code>는 내장 타입이므로 Address 클래스엔 <code class=\"language-text\">@Embeddable</code>을 통해 어딘가에 내장이 될 수 있음을 명시하고, <code class=\"language-text\">Member</code>에서는 Address를 포함하고 내장 타입을 포함했다는 애노테이션으로 <code class=\"language-text\">@Embedded</code>를 매핑하면 된다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">@Embeddable</code>나 <code class=\"language-text\">@Embedded</code> 둘 중 하나만 있어도 되지만 둘 다 써주는 걸 많이 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Embeddable</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> city<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> street<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> zipcode<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>값 타입은 기본적으로 ‘값’은 immutable해야 한다. 변경이 되면 안된다. 따라서 좋은 설계는 생성할 때 생성자에서 값을 모두 초기화하고, Setter없이 Getter만 제공하는 것이다. 그래서 생성자를 추가해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> city<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> street<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> zipcode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> city<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>street <span class=\"token operator\">=</span> street<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>zipcode <span class=\"token operator\">=</span> zipcode<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>JPA 스펙상 엔티티나 임베디드 타입(<code class=\"language-text\">@Embeddable</code>)은 자바 기본 생성자(default constructor)를 public 또는 protected로 설정해야 한다. 이 대, public 으로 두는 것 보다는 protected 로 설정하는 것이 그나마 더 안전 하다.</p>\n<p>JPA가 이런 제약을 두는 이유는 JPA 구현 라이브러리가 객체를 생성할 때 리플랙션, 프록시 같은 기술을 사용할 수 있도록 지원해야 하기 때문이다.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>Member와 Order는 일대다 관계(<code class=\"language-text\">@OneToMany</code>)이다. 반대로 Order에서는 다대일(<code class=\"language-text\">@ManyToOne</code>)이다. 서로 반대로 연관관계를 적어주자.</p>\n</li>\n<li>\n<p>연관관계의 주인을 정해줘야 한다. 서로 @ManyToOne, @OneToMany로 양방향이기 때문에 Member에서 Order를 바꿀 수도 있고 Order에서 Member를 바꿀 수도 있다. 둘 다 바꾸면 JPA는 뭘 기준으로 할 지를 명시해야 한다.</p>\n<ul>\n<li>**연관관계의 주인 -> 얘의 값이 바뀌었을 때 저 fk를 바꿀거야!**의 의미이다. 따라서 FK와 가까운 곳을 주인으로 하자! Member.orders보다 Order.member가 FK와 더 가깝다.</li>\n<li>그렇지 않으면 Member에서 무언가를 바꾸면 Order 테이블의 FK가 업데이트 되어버리므로 직관적이지 않고 관리하기가 어렵다.\n<ul>\n<li>Member를 바꾼 거 같은데 Order 테이블의 FK가 바뀌면 왜 Order가 바뀌지… 하지만 Order에 있는 Member를 바꿔서 Order의 FK가 바뀌는 건 더 직관적이다.\n내 테이블에 있는 뭔가를 바꾸니까 내 테이블이 업데이트 되는구나~</li>\n<li>그리고 추가로 성능 이슈가 생길 수도 있다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>연관관계의 주인을 나타내려면 주인은 그냥 두고 <code class=\"language-text\">@JoinColumn</code>을 잘 나타내주자. 반대로 주인이 아닌 쪽에는 <code class=\"language-text\">@OneToMany(mappedBy = \"member\")</code> 를 통해서 Order테이블에 있는 member에 나는 매핑된거야!를 표시해준다. 단지 읽기만 할 수 있다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"member_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Address</span> address<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 이제 여기 Order는 읽기 전용. Order에 매핑된 거울일 뿐!</span>\n    <span class=\"token comment\">// 따라서 여길 바꿔도 Order의 FK가 바뀌지 않는다.</span>\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"member\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">></span></span> orders <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"code-classlanguage-textordercode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textordercode\" aria-label=\"code classlanguage textordercode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">Order</code></h3>\n<ul>\n<li>\n<p><code class=\"language-text\">Order.member</code>가 연관관계의 주인이므로 Order에서 member를 바꾸면 변경 내역이 반영된다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">LocalDateTime</code> 타입:  그냥 Date 타입을 쓰면 날짜 관련 매핑을 해야 한다. 하지만 자바8에서는 LocalDateTime을 쓰면 하이버네이트가 알아서 지원해준다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">OrderStatus</code>는 enum 클래스로 주문 상태를 나타낸다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">OrderStatus</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">ORDER</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">CANCEL</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Member-Order관계처럼, 주문 하나당 여러개의 주문 상품 내역이 있을 수 있다.</p>\n<ul>\n<li><code class=\"language-text\">OrderItem</code>쪽이 Many이므로 여긴 그냥 매핑한다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token comment\">// db에 ORDER BY 예약어로 인해 order 대신 orders를 사용할 것이므로 명시해준다.</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Order</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"order_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 연관관계 주인</span>\n    <span class=\"token comment\">// 여기선 변경 내역이 반영된다.</span>\n    <span class=\"token comment\">// **멤버를 바꾸면 member_id가 바뀐다.**</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"member_id\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// foreign key 이름이 member_id가 된다.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//주인인 쪽은 JoinColumn을 정하고, 아닌 쪽은 해당 클래스에 매핑될 필드 이름을 적는다.</span>\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 나 하나에 (order 하나에) OrderItem이 여러개가 될 수 있다.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderItem</span><span class=\"token punctuation\">></span></span> orderItems<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//뒤에 설명!</span>\n    <span class=\"token annotation punctuation\">@OneToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"delivery_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Delivery</span> delivery<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> orderDate<span class=\"token punctuation\">;</span>\n\n  \t<span class=\"token annotation punctuation\">@Enumerated</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EnumType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderStatus</span> status<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"code-classlanguage-textorderitemcode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textorderitemcode\" aria-label=\"code classlanguage textorderitemcode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">OrderItem</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderItem</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"order_item_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  \t<span class=\"token comment\">//many 쪽을 연관관계의 주인으로 하고, 매핑을 하자.</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n   \t<span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//many 쪽을 연관관계의 주인으로 하고, 매핑을 하자.</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"order_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> orderPrice<span class=\"token punctuation\">;</span> <span class=\"token comment\">//주문 가격</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> count<span class=\"token punctuation\">;</span> <span class=\"token comment\">//주문 수량</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"code-classlanguage-textitemcode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textitemcode\" aria-label=\"code classlanguage textitemcode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">Item</code></h3>\n<p>구현체로 <code class=\"language-text\">Album</code>, <code class=\"language-text\">Book</code>, <code class=\"language-text\">Movie</code>를 만들 것이므로 추상클래스로 만들어주자.</p>\n<p>또한 상속관계 매핑이 필요하다.</p>\n<ul>\n<li>\n<p>상속관계 전략을 지정해줘야 한다.</p>\n</li>\n<li>\n<p>부모에 전략을 적어주자.</p>\n<ul>\n<li>\n<p>우린 싱글테이블 전략을 쓰니까</p>\n<ul>\n<li><code class=\"language-text\">@Inheritance(strategy = InheritanceType.SINGLE_TABLE)</code>\n<ul>\n<li><code class=\"language-text\">InheritanceType.JOINED</code>: 가장 정규화된 스타일</li>\n<li><code class=\"language-text\">InheritanceType.SINGLE_TABLE</code>: 한 테이블에 때려박기</li>\n<li><code class=\"language-text\">InheritanceType.TABLE_PER_CLASS</code>: 구현체들, Book, Movie, Album 세 개의 테이블이 나오는 전략</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>그럼 어떤 컬럼으로 하위 클래스를 구분할 지도 명시해주자. 관례는 default = dtype</p>\n<p><code class=\"language-text\">@DiscriminatorColumn(name = \"dtype\")</code></p>\n<ul>\n<li>그리고 하위 클래스에는 <code class=\"language-text\">@DiscriminatorValue(\"B\")</code>로 어떤 값으로 들어갈 지를 적어줄 수 있다. 기본으로 두면 클래스 이름</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Inheritance</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">InheritanceType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SINGLE_TABLE</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@DiscriminatorColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"dtype\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 구현체를 만들 것이므로 추상클래스로 해주자.</span>\n\n    <span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> price<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> stockQuantity<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//카테고리는 뒤에서...</span>\n    <span class=\"token annotation punctuation\">@ManyToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"items\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Category</span><span class=\"token punctuation\">></span></span> categories <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">Album</code></p>\n<ul>\n<li><code class=\"language-text\">Book</code>, <code class=\"language-text\">Movie</code>도 마찬가지. <code class=\"language-text\">@DiscriminatorValue</code> 줘본다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@DiscriminatorValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Album</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> artist<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> etc<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<h3 id=\"code-classlanguage-textdeliverycode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textdeliverycode\" aria-label=\"code classlanguage textdeliverycode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">Delivery</code></h3>\n<ul>\n<li>\n<p>enum으로 <code class=\"language-text\">DeliveryStatus</code>를 갖는다. enum 타입 사용 시 주의할 점은 <code class=\"language-text\">@Enumerated(EnumType)</code>을 꼭 명시해야 한다. 이 때  EnumType은 db에 enum이 어떻게 들어갈 지를 명시하는 건데, 만약 <code class=\"language-text\">EnumType.ORDINAL</code>을 사용 시엔 DB에 enum <u><strong>순서대로 숫자가 들어가게</strong></u> 된다. 이렇게 했을 때 문제점은, 만약 enum 사이에 무언가 추가되면? 객체가 다 밀리면서 문제가 발생한다.</p>\n<ul>\n<li>따라서 꼭❗️❗️❗️ <code class=\"language-text\">EnumType.String</code>으로 옵션을 주자.</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">Order</code>와 Delivery가 1대1 매핑이므로 둘 다 <code class=\"language-text\">@OneToOne</code> 매핑을 하면 된다… 이 때  JPA에서는 FK를 <code class=\"language-text\">Order</code>에 둬도 되고, <code class=\"language-text\">Delivery</code>에 둬도 된다.</p>\n<blockquote>\n<p>일대일 관계에서 FK를 둘 때 선호하는 스타일은 주로 접근을 많이 하는 쪽에 둔다. 만약 시스템이 Delivery를 가지고  Order를 볼 일보다, Order를 가지고  Delivery를 볼 일이 더 많다면 주로  Order에 둔다.</p>\n<p>따라서 Order에 <code class=\"language-text\">DELIVERY_ID</code> Foreign key를 두자. 그럼 연관관계 주인을 <code class=\"language-text\">Order.delivery</code>로 두자.</p>\n</blockquote>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Delivery</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"delivery_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToOne</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"delivery\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Address</span> address<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Enumerated</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EnumType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DeliveryStatus</span> status<span class=\"token punctuation\">;</span> <span class=\"token comment\">//READY, COMP</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"code-classlanguage-textcategorycode\" style=\"position:relative;\"><a href=\"#code-classlanguage-textcategorycode\" aria-label=\"code classlanguage textcategorycode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">Category</code></h3>\n<ul>\n<li>\n<p>다대다 관계는.. 중간 테이블이 필요하다! 따라서 연관관계에서 <code class=\"language-text\">@JoinColumn</code>이 아니라 <code class=\"language-text\">@JoinTable</code>이 필요하다.</p>\n<ul>\n<li>\n<p>객체는 각 객체에서 Collection을 가지고 다대다 관계가 가능하지만, 관계형 DB는 Collection 관계를 양쪽에 가질 수 없으므로 중간 테이블이 일대다/다대일 관계로 풀어내야 한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">@JoinTable</code>사용 시 JPA가 관계형 db에 다대다 관계를 넣을 수 있도록 넣어준다!</p>\n<ul>\n<li>실전에서 쓰지 말라고 하는 이유는.. 이렇게 만들면 <u><strong>더 이상 필드를 추가하는 게 불가능</strong></u>하다.</li>\n<li>그냥 딱 양쪽 테이블 id를 FK로 갖는 것만 가능하다. (위 db 다이어그램에서 CATEGORY_ITEM이 FK로 category_id와 item_id만 갖는 것처럼) 따라서 사실상 거의 못쓴다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// cateogory</span>\n<span class=\"token annotation punctuation\">@ManyToMany</span>\n<span class=\"token annotation punctuation\">@JoinTable</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"category_item\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 중간 테이블에 있는 column 이름</span>\n  joinColumns <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"category_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 중간 테이블에서 아이템 쪽으로 들어가는 column</span>\n  inverseJoinColumns <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> items <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>다른 연관관계 매핑과 마찬가지로, category 반대로 item에는 `@ManyToMany(mappedBy = “items”)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>카테고리 간에 부모-자식 관계가 있다. 그럼 <u><strong>같은 엔티티인데 연관관계가 있게 된다.</strong></u></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">//Many쪽에서 주인</span>\n<span class=\"token annotation punctuation\">@ManyToOne</span>\n<span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"parent_id\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">Category</span> parent<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"parent\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Category</span><span class=\"token punctuation\">></span></span> children <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>전체 코드</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Category</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"category_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToMany</span>\n    <span class=\"token annotation punctuation\">@JoinTable</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"category_item\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// 중간 테이블에 있는 column 이름</span>\n            joinColumns <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"category_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// 중간 테이블에서 아이템 쪽으로 들어가는 column</span>\n            inverseJoinColumns <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> items <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"parent_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Category</span> parent<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"parent\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Category</span><span class=\"token punctuation\">></span></span> children <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<h3 id=\"실행\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89\" aria-label=\"실행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행</h3>\n<ul>\n<li>\n<p>실행 후 테이블이 원하는 대로 잘 생성되는 지 봐보자.</p>\n</li>\n<li>\n<p>JPA는 foreign key를 다 잡아준다.</p>\n<blockquote>\n<p>foreign key를 다 거는 게 좋을까 아닌 게 더 좋을까?</p>\n<hr>\n<p>시스템마다 다른 것 같다. 실시간 트래픽 엄청 중요하고, 정확성보다 유연하게 잘 서비스되는 게 더 중요하면 foreign key를 빼고 인덱스를 잘 잡아주는 게 중요하다. 하지만 돈과 관련된 중요한 서비스고, 데이터가 항상 꼭 맞아야 한다면 foreign key를 걸어주는 게 더 나은 선택일 수 있다.</p>\n<p>결론: 상황마다 다르다.</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"-엔티티-설계시-주의점\" style=\"position:relative;\"><a href=\"#-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%84%A4%EA%B3%84%EC%8B%9C-%EC%A3%BC%EC%9D%98%EC%A0%90\" aria-label=\" 엔티티 설계시 주의점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 엔티티 설계시 주의점</h2>\n<ul>\n<li>\n<p>엔티티에는 가급적 Setter를 사용하지 말자</p>\n<p>Setter가 모두 열려있으면 변경포인트가 너무 많아서 유지보수가 어렵다.</p>\n</li>\n<li>\n<p><u><strong>모든 연관관계는 지연로딩으로 설정해야 한다.</strong></u> ✨✨✨</p>\n<blockquote>\n<p>즉시로딩 vs. 지연로딩</p>\n<ul>\n<li>즉시로딩(<code class=\"language-text\">EAGER</code>): 엔티티를 조회할 때 <u><strong>연관된 엔티티들을 다같이</strong></u> 로딩. 즉시로딩은 예측이 어렵고, 어떤 SQL이 실행될지 추적하기 어렵다. 특히 JPQL을 실행할 때 N+1 문제가 자주 발생한다.\n<ul>\n<li>만약 Order를 조회하는 데 Order.member가 EAGER로 되어 있다면? 만약 Order가 100개였다면 Order.member를 조회하기 위한 쿼리가 100개 추가로 날아가게 된다. ➡️ <code class=\"language-text\">N+1</code> 문제. N개 쿼리가 각각 추가로 쿼리를 더 날린다.</li>\n</ul>\n</li>\n</ul>\n<p>따라서 기본적으로 모든 연관관계는 지연로딩(<code class=\"language-text\">LAZY</code>)으로 설정해야 한다.</p>\n<ul>\n<li>그리고 연관된 엔티티를 함께 DB에서 조회해야 하면,  <code class=\"language-text\">fetch join</code> 또는 <code class=\"language-text\">엔티티 그래프</code> 기능을 사용하자.</li>\n</ul>\n<p><code class=\"language-text\">@XToOne</code>, 즉 <code class=\"language-text\">@ManyToOne</code>, <code class=\"language-text\">@OneToOne</code>은 기본적으로  fetch type이 <code class=\"language-text\">eager</code>다.</p>\n<ul>\n<li><code class=\"language-text\">FetchType fetch() default EAGER;</code></li>\n<li><code class=\"language-text\">@XToMany</code>는 <code class=\"language-text\">LAZY</code></li>\n<li><u><strong>따라서 <code class=\"language-text\">@~ToOne</code>은 꼭 다 찾아서 <code class=\"language-text\">LAZY</code>로 바꿔야 한다!</strong></u> ✨✨✨</li>\n<li><code class=\"language-text\">@ManyToOne</code> ➡️ <code class=\"language-text\">@ManyToOne(fetch = FetchType.LAZY)</code></li>\n</ul>\n<p>간혹 Transaction 밖에서 Lazy loading이 안된다던가 하는 exception 등의 이슈가 있는데 다 대안이 있다.</p>\n</blockquote>\n<ul>\n<li>그래서 우리 코드에서도 <code class=\"language-text\">@~ToOne</code>들의 FetchType을 바꿔주자.</li>\n</ul>\n</li>\n<li>\n<h3 id=\"컬렉션은-u필드에서-초기화u-하자\" style=\"position:relative;\"><a href=\"#%EC%BB%AC%EB%A0%89%EC%85%98%EC%9D%80-u%ED%95%84%EB%93%9C%EC%97%90%EC%84%9C-%EC%B4%88%EA%B8%B0%ED%99%94u-%ED%95%98%EC%9E%90\" aria-label=\"컬렉션은 u필드에서 초기화u 하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컬렉션은 <u><strong>필드에서 초기화</strong></u> 하자.</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">//class Member</span>\n<span class=\"token comment\">//1. 필드 초기화</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">></span></span> orders <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//2. 생성자 초기화</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  orders <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>컬렉션은 필드에서 바로 초기화 하는 것이 안전하다.</p>\n</li>\n<li>\n<p>NPE가 날 일이 없다.</p>\n</li>\n<li>\n<p>하이버네이트가 엔티티를 영속화할 때, 즉 db에 저장하게 되면 그 이후로 하이버네이트가 해당 엔티티를 관리해야된다. 따라서 하이버네이트가 추적할 수 있는 본인의 컬렉션으로 기존컬렉션을 감싸버린다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getOrders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>team<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getOrders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//출력 결과</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span>ArrayList</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>hibernate<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span></span>PersistentBag</span></code></pre></div>\n<ul>\n<li>근데 이 상태에서 누군가 set해서 컬렉션을 바꿔버린다면? 원하지 않는 메커니즘으로 돌아갈 수 있다.</li>\n<li>따라서 웬만하면 필드에서 초기화한 후에 수정은 하지 말자.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<h3 id=\"테이블-컬럼명-생성-전략\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%BB%AC%EB%9F%BC%EB%AA%85-%EC%83%9D%EC%84%B1-%EC%A0%84%EB%9E%B5\" aria-label=\"테이블 컬럼명 생성 전략 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테이블, 컬럼명 생성 전략</h3>\n<ul>\n<li>\n<p>하이버네이트 기존 과거 구현: 엔티티의 필드명을 그대로 테이블의 컬럼명으로 사용 (<code class=\"language-text\">SpringPhysicalNamingStrategy</code> )</p>\n</li>\n<li>\n<p>스프링 부트 신규 설정 (엔티티(필드) ➡️ 테이블(컬럼))</p>\n<ol>\n<li>자바 camelCase ➡️ snake_case</li>\n<li>.(점) ➡️ _(언더스코어)</li>\n<li>대문자 ➡️ 소문자</li>\n</ol>\n<p>예) orderDate -> order_date</p>\n</li>\n<li>\n<p>스프링 부트 설정 변경</p>\n<ul>\n<li>\n<p>논리명 생성: 컬럼명/테이블명을 명시하지 않았을 때 논리명 적용.</p>\n<ul>\n<li>기본 설정: <code class=\"language-text\">spring.jpa.hibernate.naming.implicit-strategy: org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy</code></li>\n</ul>\n</li>\n<li>\n<p>물리명 적용: 적혀있든 적혀있지 않든 모든 논리명에 적용됨. 실제 테이블에 적용</p>\n<ul>\n<li>\n<p>기본 설정:</p>\n<p><code class=\"language-text\">spring.jpa.hibernate.naming.physical-strategy: org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>바꾸고 싶으면 Spring~~Strategy 클래스를 참고해서 만들고 바꿔주면 된다.</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<h2 id=\"cascade\" style=\"position:relative;\"><a href=\"#cascade\" aria-label=\"cascade permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cascade</h2>\n<ul>\n<li>\n<p>만약 엔티티를 저장하면(persist)</p>\n</li>\n<li>\n<p>연관관계가 있는 엔티티는 따로 영속화해줘야 한다.</p>\n<ul>\n<li><u><strong>즉, 모든 엔티티는 저장하고 싶다면 persist를 각자 해줘야 한다.</strong></u></li>\n</ul>\n</li>\n<li>\n<p>예를 들어,  <code class=\"language-text\">Order</code> 엔티티가 있고, Order안에 <code class=\"language-text\">List&lt;OrderItem> orderItems</code>가 있을 때, 영속화할 시 <code class=\"language-text\">persist(order)</code>뿐만 아니라 <code class=\"language-text\">persist(orderItemA)...persist(orderItemN)</code>을 모두 따로 해줘야 한다.</p>\n</li>\n<li>\n<p>하지만 필드에  <u><strong>cascade</strong></u>를 이용하면, 영속화가 쭉 내려가서 전파되기 때문에 따로 해줄 필요가 없다.</p>\n</li>\n<li>\n<p>예)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderItem</span><span class=\"token punctuation\">></span></span> orderItems<span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<h3 id=\"연관관계-편입-메서드-사용하자\" style=\"position:relative;\"><a href=\"#%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%ED%8E%B8%EC%9E%85-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EC%9E%90\" aria-label=\"연관관계 편입 메서드 사용하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>연관관계 편입 메서드 사용하자</h3>\n<ul>\n<li>\n<p>JPA는 둘째 치고 객체를 봤을 때,</p>\n</li>\n<li>\n<p>양방향 연관관계를 세팅하려면 <code class=\"language-text\">Member</code>가 주문 시에 주문을 Member의 <code class=\"language-text\">List&lt;order></code>에 넣어줘야 한다. 그래야 멤버에서 order 접근하여 <code class=\"language-text\">orders.get..</code>도 할 수 있어야 하고, <code class=\"language-text\">Order</code>에서도 <code class=\"language-text\">order.getMember()....</code>도 할 수 있어야 한다. 러면 <u><strong>양쪽에 값을 세팅</strong></u>해줘야 한다.</p>\n</li>\n<li>\n<p>물론 DB에 저장하는 건 연관관계의 주인에만 있어도 되지만.. 객체 상에서도 필요하다.</p>\n</li>\n<li>\n<p>해당 엔티티에 넣을 때 반대로 양방향도 넣어줘야 한다. 근데 매번 해당 로직이 비즈니스 로직에 섞여있으면 빼먹을 수도 있고.. 그래서 원자적으로 해당 엔티티를 연결해주는 함수를 만들고 편하게 쓰자.</p>\n</li>\n<li>\n<p>메서드는 어디에?</p>\n<ul>\n<li>주로 핵심적으로 컨트롤을 하는 쪽이 들고 있는 게 좋다.</li>\n</ul>\n</li>\n<li>\n<p>예)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Order</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderItem</span><span class=\"token punctuation\">></span></span> orderItems<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"delivery_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Delivery</span> delivery<span class=\"token punctuation\">;</span>\n  \n    <span class=\"token comment\">//**연관관계 편입 메서드**//</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setMember</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>member <span class=\"token operator\">=</span> member<span class=\"token punctuation\">;</span>\n        member<span class=\"token punctuation\">.</span><span class=\"token function\">getOrders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addOrderItem</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderItem</span> orderItem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        orderItems<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>orderItem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        orderItem<span class=\"token punctuation\">.</span><span class=\"token function\">setOrder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addDelivery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Delivery</span> delivery<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>delivery <span class=\"token operator\">=</span> delivery<span class=\"token punctuation\">;</span>\n        delivery<span class=\"token punctuation\">.</span><span class=\"token function\">setOrder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Category</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">//...</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addChildCategory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Category</span> child<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        child<span class=\"token punctuation\">.</span><span class=\"token function\">setParent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>굳이 연관관계 메서드를 이렇게까지 만들어야 할까? ➡️ 기본편…</p>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%B6%84%EC%84%9D-%EC%84%A4%EA%B3%84\">☘️ 도메인 분석 설계</a></p>\n<ul>\n<li>\n<p><a href=\"#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D\">📌 요구사항 분석</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%AA%A8%EB%8D%B8%EA%B3%BC-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%84%A4%EA%B3%84\">📌 도메인 모델과 테이블 설계</a></p>\n<ul>\n<li><a href=\"#%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%AA%A8%EB%8D%B8-%ED%81%B0%EA%B7%B8%EB%A6%BC\">도메인 모델 (큰그림)</a></li>\n<li><a href=\"#%ED%9A%8C%EC%9B%90-%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%B6%84%EC%84%9D-%EC%8B%A4%EC%A0%9C\">회원 엔티티 분석 (실제)</a></li>\n<li><a href=\"#%ED%9A%8C%EC%9B%90-%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%B6%84%EC%84%9D\">회원 테이블 분석</a></li>\n<li><a href=\"#%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EB%B6%84%EC%84%9D-\">연관관계 매핑 분석 ✨✨✨</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%97%94%ED%8B%B0%ED%8B%B0-%ED%81%B4%EB%9E%98%EC%8A%A4-%EA%B0%9C%EB%B0%9C\">📌 엔티티 클래스 개발</a></p>\n<ul>\n<li><a href=\"#member\"><code class=\"language-text\">Member</code></a></li>\n<li><a href=\"#order\"><code class=\"language-text\">Order</code></a></li>\n<li><a href=\"#orderitem\"><code class=\"language-text\">OrderItem</code></a></li>\n<li><a href=\"#item\"><code class=\"language-text\">Item</code></a></li>\n<li><a href=\"#delivery\"><code class=\"language-text\">Delivery</code></a></li>\n<li><a href=\"#category\"><code class=\"language-text\">Category</code></a></li>\n<li><a href=\"#%EC%8B%A4%ED%96%89\">실행</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%84%A4%EA%B3%84%EC%8B%9C-%EC%A3%BC%EC%9D%98%EC%A0%90\">📌 엔티티 설계시 주의점</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"본 게시글은 실전! 스프링 부트와 JPA 활용1 강의를 듣고 정리했습니다. ☘️ 도메인 분석 설계 📌 요구사항 분석  기능 목록 회원 기능 회원 등록 회원 조회 상품 기능 상품 등록 상품 수정 상품 조회 주문 기능 상품 주문 주문 내역 조회 주문 취소 기타 요구사항 상품은 재고 관리가 필요하다. (구매하면 수량 빼고, 주문 취소하면 다시 수량 원복하고..) 상품의 종류는 도서, 음반, 영화가 있다. 상품을 카테고리로 구분할 수 있다. 상품 주문시 배송 정보를 입력할 수 있다. 📌 도메인 모델과 테이블 설계 도메인 모델 (큰그림)  회원, 주문, 상품의 관계: 우선 회원은 여러 주문을 할 수 있다. 그리고 한 주문에 여러 상품이 가능하고, 상품도 여러 주문에 들어갈 수 있으므로 주문과 상품은 다대다 관계다. 하지만 이런 다대다 관계는 관계형 데이터베이스는 물론이고 엔티 티에서도 거의 사용하지 않는다. 따라서 그림처럼 주문상품이라는 엔티티를 추가해서 다대다 관계를 일대 다, 다대일 관계…","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%B6%84%EC%84%9D-%EC%84%A4%EA%B3%84\">☘️ 도메인 분석 설계</a></p>\n<ul>\n<li>\n<p><a href=\"#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D\">📌 요구사항 분석</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%AA%A8%EB%8D%B8%EA%B3%BC-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%84%A4%EA%B3%84\">📌 도메인 모델과 테이블 설계</a></p>\n<ul>\n<li><a href=\"#%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%AA%A8%EB%8D%B8-%ED%81%B0%EA%B7%B8%EB%A6%BC\">도메인 모델 (큰그림)</a></li>\n<li><a href=\"#%ED%9A%8C%EC%9B%90-%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%B6%84%EC%84%9D-%EC%8B%A4%EC%A0%9C\">회원 엔티티 분석 (실제)</a></li>\n<li><a href=\"#%ED%9A%8C%EC%9B%90-%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%B6%84%EC%84%9D\">회원 테이블 분석</a></li>\n<li><a href=\"#%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EB%B6%84%EC%84%9D-\">연관관계 매핑 분석 ✨✨✨</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%97%94%ED%8B%B0%ED%8B%B0-%ED%81%B4%EB%9E%98%EC%8A%A4-%EA%B0%9C%EB%B0%9C\">📌 엔티티 클래스 개발</a></p>\n<ul>\n<li><a href=\"#code-classlanguage-textmembercode\"><code class=\"language-text\">Member</code></a></li>\n<li><a href=\"#code-classlanguage-textordercode\"><code class=\"language-text\">Order</code></a></li>\n<li><a href=\"#code-classlanguage-textorderitemcode\"><code class=\"language-text\">OrderItem</code></a></li>\n<li><a href=\"#code-classlanguage-textitemcode\"><code class=\"language-text\">Item</code></a></li>\n<li><a href=\"#code-classlanguage-textdeliverycode\"><code class=\"language-text\">Delivery</code></a></li>\n<li><a href=\"#code-classlanguage-textcategorycode\"><code class=\"language-text\">Category</code></a></li>\n<li><a href=\"#%EC%8B%A4%ED%96%89\">실행</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%84%A4%EA%B3%84%EC%8B%9C-%EC%A3%BC%EC%9D%98%EC%A0%90\">📌 엔티티 설계시 주의점</a></p>\n</li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"October 12, 2022","title":"02. 도메인 분석 설계 - 실전! 스프링 부트와 JPA 활용1","categories":"강의","author":"goldggyul","emoji":null,"imageEmoji":"hibernate-logo.png"},"fields":{"slug":"/spring-jpa-use-002/"}},"next":{"id":"e1e04ee5-c75a-56ca-b789-3fad20aecf56","html":"<blockquote>\n<p>본 게시글은 <a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/\">실전! 스프링 부트와 JPA 활용1</a> 강의를 듣고 정리했습니다.</p>\n</blockquote>\n<h1 id=\"️-프로젝트-환경-설정\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\"️ 프로젝트 환경 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>☘️ 프로젝트 환경 설정</h1>\n<ul>\n<li>SpringBoot, JPA, HIBERNATE, Gradle, Tomcat, Thymeleaf</li>\n</ul>\n<h2 id=\"-프로젝트-생성\" style=\"position:relative;\"><a href=\"#-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-label=\" 프로젝트 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 프로젝트 생성</h2>\n<ul>\n<li>\n<p>스프링 부트 스타터(<a href=\"https://start.spring.io/\">https://start.spring.io/</a>)</p>\n</li>\n<li>\n<p>스프링 부트 버전은 2.4.x 버전</p>\n</li>\n<li>\n<p>사용 기능: web, thymeleaf, jpa, h2, lombok, validation</p>\n</li>\n<li>\n<p>여기선 스프링 데이터 jpa는 쓰지 않고 그냥 jpa를 사용한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">build.gradle</code> Gradle 전체 설정</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">plugins <span class=\"token punctuation\">{</span>\n\tid 'org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot' version <span class=\"token char\">'2.4.1'</span>\n\tid 'io<span class=\"token punctuation\">.</span>spring<span class=\"token punctuation\">.</span>dependency<span class=\"token operator\">-</span>management' version '<span class=\"token number\">1.0</span><span class=\"token number\">.14</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RELEASE</span>'\n\tid <span class=\"token char\">'java'</span>\n<span class=\"token punctuation\">}</span>\n\ngroup <span class=\"token operator\">=</span> 'jpabook'\nversion <span class=\"token operator\">=</span> '<span class=\"token number\">0.0</span><span class=\"token number\">.1</span><span class=\"token operator\">-</span><span class=\"token constant\">SNAPSHOT</span>'\nsourceCompatibility <span class=\"token operator\">=</span> <span class=\"token char\">'11'</span>\n\n<span class=\"token comment\">// lombok</span>\nconfigurations <span class=\"token punctuation\">{</span>\n\tcompileOnly <span class=\"token punctuation\">{</span>\n\t\textendsFrom annotationProcessor\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nrepositories <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">mavenCentral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\ndependencies <span class=\"token punctuation\">{</span>\n\timplementation 'org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token operator\">:</span>spring<span class=\"token operator\">-</span>boot<span class=\"token operator\">-</span>starter<span class=\"token operator\">-</span>data<span class=\"token operator\">-</span>jpa'\n\timplementation 'org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token operator\">:</span>spring<span class=\"token operator\">-</span>boot<span class=\"token operator\">-</span>starter<span class=\"token operator\">-</span>thymeleaf'\n\timplementation 'org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token operator\">:</span>spring<span class=\"token operator\">-</span>boot<span class=\"token operator\">-</span>starter<span class=\"token operator\">-</span>validation'\n\timplementation 'org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token operator\">:</span>spring<span class=\"token operator\">-</span>boot<span class=\"token operator\">-</span>starter<span class=\"token operator\">-</span>web'\n\tcompileOnly 'org<span class=\"token punctuation\">.</span>projectlombok<span class=\"token operator\">:</span>lombok'\n\truntimeOnly 'com<span class=\"token punctuation\">.</span>h2database<span class=\"token operator\">:</span>h2'\n\tannotationProcessor 'org<span class=\"token punctuation\">.</span>projectlombok<span class=\"token operator\">:</span>lombok'\n\ttestImplementation 'org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token operator\">:</span>spring<span class=\"token operator\">-</span>boot<span class=\"token operator\">-</span>starter<span class=\"token operator\">-</span>test'\n<span class=\"token punctuation\">}</span>\n\ntasks<span class=\"token punctuation\">.</span><span class=\"token function\">named</span><span class=\"token punctuation\">(</span><span class=\"token char\">'test'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">useJUnitPlatform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>gradle이 추가한 의존성과 관련 있는 걸 다 땡겨와준다.</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">lombok</code></p>\n<p><code class=\"language-text\">Preferences > Annotation Processors > Enable annotation processing</code></p>\n<ul>\n<li>lombok 잘 되는 지 <code class=\"language-text\">@Getter</code>  <code class=\"language-text\">@Setter</code>확인</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-라이브러리-살펴보기\" style=\"position:relative;\"><a href=\"#-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" aria-label=\" 라이브러리 살펴보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 라이브러리 살펴보기</h2>\n<ul>\n<li>라이브러리끼리의 의존 관계를 보고 싶다면 <code class=\"language-text\">./gradlew dependencies</code></li>\n<li>혹은 인텔리제이에서 확인</li>\n</ul>\n<blockquote>\n<ul>\n<li><code class=\"language-text\">spring-boot-starter-web</code>\n<ul>\n<li><code class=\"language-text\">spring-boot-starter-tomcat</code>: 톰캣 (웹서버)</li>\n<li><code class=\"language-text\">spring-webmvc</code>: 스프링 웹 MVC</li>\n</ul>\n</li>\n<li><code class=\"language-text\">spring-boot-starter-thymeleaf</code>: 타임리프 템플릿 엔진(View)</li>\n<li><code class=\"language-text\">spring-boot-starter-data-jpa</code>\n<ul>\n<li><code class=\"language-text\">spring-boot-starter-aop</code></li>\n<li><code class=\"language-text\">spring-boot-starter-jdbc</code>\n<ul>\n<li><code class=\"language-text\">HikariCP</code>: 커넥션풀</li>\n</ul>\n</li>\n<li><code class=\"language-text\">hibernate + JPA</code>: 하이버네이트 + JPA</li>\n<li><code class=\"language-text\">spring-data-jpa</code>: 스프링 데이터 JPA</li>\n<li><code class=\"language-text\">spring-boot-starter</code>\n<ul>\n<li><code class=\"language-text\">spring-boot-starter-loggin</code>\n<ul>\n<li><code class=\"language-text\">logback-classic</code></li>\n<li><code class=\"language-text\">log4j</code>\n<ul>\n<li><code class=\"language-text\">slf4j</code>는 로그를 찍는 인터페이스 모음</li>\n<li>그 구현체로 <code class=\"language-text\">logback</code>혹은 <code class=\"language-text\">log4j</code>를 넣거나…</li>\n<li>대세는 <u><strong><code class=\"language-text\">slf4j</code>에 <code class=\"language-text\">logback</code></strong></u></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><code class=\"language-text\">spring-boot</code>\n<ul>\n<li><code class=\"language-text\">spring-core</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>테스트 라이브러리</li>\n<li><code class=\"language-text\">spring-boot-starter-test </code>\n<ul>\n<li>junit: 테스트 프레임워크</li>\n<li>mockito: 목 라이브러리</li>\n<li>assertj: 테스트 코드를 좀 더 편하게 작성하게 도와주는 라이브러리</li>\n<li>spring-test: 스프링 통합 테스트 지원</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<ul>\n<li>\n<p>핵심 라이브러리</p>\n<ul>\n<li>\n<p>스프링 MVC</p>\n</li>\n<li>\n<p>스프링 ORM</p>\n</li>\n<li>\n<p>JPA, 하이버네이트</p>\n</li>\n<li>\n<p>스프링 데이터 JPA (이 강의에서 쓰진 않지만)</p>\n<blockquote>\n<p>스프링 데이터 JPA는 스프링과 JPA를 먼저 이해하고 사용해야 하는 응용기술이다</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p>기타 라이브러리</p>\n<ul>\n<li>H2 데이터베이스 클라이언트</li>\n<li>커넥션 풀: 부트 기본은 HikariCP</li>\n<li>WEB(thymeleaf)</li>\n<li>로깅 SLF4J &#x26; LogBack</li>\n<li>테스트</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-view-환경-설정\" style=\"position:relative;\"><a href=\"#-view-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\" view 환경 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 View 환경 설정</h2>\n<ul>\n<li>\n<p>thymeleaf 템플릿 엔진 사용</p>\n<ul>\n<li>장점: html 마크업을 깨지 않고 그대로 사용. 그래서 브라우저에서 열어서 볼 수 있다.</li>\n<li>단점: 메뉴얼을 좀 봐야 한다.\n<ul>\n<li><a href=\"https://www.thymeleaf.org/\">https://www.thymeleaf.org/</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>요즘은 템플릿 엔진으로 서버 사이드 렌더링하는 것보다는 리액트나 뷰같은 거로 사용하기도 한다.</p>\n</li>\n<li>\n<p>스프링 공식 튜토리얼: <a href=\"https://spring.io/guides/gs/serving-web-content/\">https://spring.io/guides/gs/serving-web-content/</a></p>\n</li>\n<li>\n<p>스프링부트 메뉴얼: <a href=\"https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/#boot-features-developing-web-applications.html#boot-features-spring-mvc-template-engines\">https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/#boot-features-developing-web-applications.html#boot-features-spring-mvc-template-engines</a></p>\n</li>\n<li>\n<p>의존성에 <code class=\"language-text\">spring-boot-starter-thymeleaf</code>만 있으면 되므로 설정할 게 없다!</p>\n</li>\n<li>\n<p>그럼 바로 테스트를 해보자.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">HelloController</code></p>\n<ul>\n<li>\n<p>MVC 컨트롤러이므로 <code class=\"language-text\">@Controller</code>를 적어준다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">resources:templates/{viewName}.html</code>으로 스프링 부트가 찾아준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 일반적으로 컴포넌트 스캔해주므로 빈으로 등록됨</span>\n<span class=\"token comment\">// 그 중에서도 @Controller이므로 스프링 MVC 컨트롤러로 인식된다.</span>\n<span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Model에 데이터를 실어서 뷰에 넘길 수 있다.</span>\n        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello!!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 화면 이름. 관례 상 resources:templates/{viewName}.html</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">resources:templates/hello.html</code></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">HTML</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Hello<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">'</span>안녕하세요. ' + ${data}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span>안녕하세요. 손님<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ul>\n<li>html의 네임스페이스를 타임리프로 준다.</li>\n<li>순수하게 그냥 html을 열면 p태그 text가 태그 안에 내용대로 ‘안녕하세요. 손님’으로 나오고, 서버 사이드 렌더링이 되면 <code class=\"language-text\">${data}</code>에 모델 값이 들어가서 나온다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>위에 처럼 렌더링 되는 페이지 말고 그냥 정적인 html을 보여주자. static 폴더에 추가한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">resources:static/index.html</code></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">HTML</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Hello<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\nHello\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/hello<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>hello<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!-- 누르면 위에 컨트롤러로 연결! --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>이 때 resources에 추가하고 해당 파일 테스트하려면 <u><strong>서버를 다시 띄워야 한다.</strong></u> 하지만 이게 귀찮으니까 라이브러리를 추가해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">implementation <span class=\"token string\">'org.springframework.boot:spring-boot-devtools'</span></code></pre></div>\n<ul>\n<li>그럼 파일을 바꾸고, 바꾼 템플릿 파일에서 <code class=\"language-text\">Build>Recompile '~~.html'</code> 후에 새로고침하면 바뀐다!</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-h2-데이터베이스-설치\" style=\"position:relative;\"><a href=\"#-h2-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%84%A4%EC%B9%98\" aria-label=\" h2 데이터베이스 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 H2 데이터베이스 설치</h2>\n<ul>\n<li>\n<p>⚠️ H2 데이터베이스 버전은 1.4.199 여야 한다. 1.4.200을 설치하면 오동작 할 수 있다고 한다.</p>\n<blockquote>\n<p>난 이미 깔려있어서.. h2 콘솔에서 버전 확인해보니 1.4.200으로 나와서 다시 깔까 했지만 일단 gradle에서도 <code class=\"language-text\">h2 1.4.200</code>버전을 끌어 와서 일단은 그냥 해본다.</p>\n<ul>\n<li><code class=\"language-text\">SELECT H2VERSION() FROM DUAL</code>로 확인 가능하다.</li>\n</ul>\n</blockquote>\n</li>\n<li>\n<p>최초 접속 시에는 한 번 db를 생성해야 한다.</p>\n<ul>\n<li>\n<p>이 때 설정을 <code class=\"language-text\">Generic H2 (Embedded)</code>로 설정하면 알아서 파일 기반으로해주더라. 아님 그 전 설정이 남아있는 건가..?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 443px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVQ4y42T2Y7bNhRA/el9adqXPuYnAmQe2k4SIMk0RRvU402WtS/WZu2kZNkzmQySAqegPHEGQQv04fBeUODhJXk1ufir5umrkp9+zvn+ecYTxYWK6cgPj/L/4seLlO+eJSjXZOZmvJwHXM4CLucRL5cxl/OYF4uUF4uEX2fRGM8s0xOP5xYJv8xiFn7BRFYu9vo1zvoNVTLj/uCTx2s8c0oSaITOHN+cYmp/IEqfz3ct9zcVnz40/P1Rjny6E8jS5aaPmeSZw3L+lo32O01pIxqPbWjhuhZh6OI6Jpa1wTDWlOWOYZAMh54iD1mvfsPc/InnXNNWDp1ImLR1SJFtqHJznFQkkYHvrYm3JlFo4Lsarr2kLEI6uRupco/AnRIFc9JohahteiWUzZY81dklOlmypi4smspF1B5tpVC5j2wDmtKlKuwRlcsmQCjqgLp8qLAuPWzjHcb6Cm35hmq3IY4sTEvHMDTyIuX+/pbDIDkeO26O/YjKjwd54thxGFo6kSphgmVEuE5MFnvI1mWmGSyWBivTYzpdols+adOT1N0j+jNpsycsJFmZM2mqLbah4Tk65U4dw2Wpm6w0C90OuL5esfkXYVwJ4rIhqU6EeUVe7ZTQx9Sv8J33dO1JuA0NhkPH3YeBu49Hbm/3HAZx5njoEE1MUxqIyqIdMdnLhEmZu2iLt/jOlK5Vj2Aj22y8s2EvvjI8sFfSDtGm48uqAhSiduiVUDRbku1ybJ0vH5rq1B5KrBb2csfQF+wfGPoS2UbfCO2TsBMRfeuO1Y27CA9Tf8dGu0JbvGb6/pKtP6VrHNrSPB/vJHPGNbJ2vgrVoHpONv4Z8U38P6g/bN9l/APG+uwJSZNw0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012034421096\"\n        title=\"image-20221012034421096\"\n        src=\"/static/8dbe581355b23f722b54fa9529c4ec2d/a120c/image-20221012034421096.png\"\n        srcset=\"/static/8dbe581355b23f722b54fa9529c4ec2d/e9ff0/image-20221012034421096.png 180w,\n/static/8dbe581355b23f722b54fa9529c4ec2d/f21e7/image-20221012034421096.png 360w,\n/static/8dbe581355b23f722b54fa9529c4ec2d/a120c/image-20221012034421096.png 443w\"\n        sizes=\"(max-width: 443px) 100vw, 443px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p><code class=\"language-text\">~/jpashop.mv.db</code> 파일 생성 확인</p>\n</li>\n<li>\n<p>그 후에는 <code class=\"language-text\">Generic H2 (Server)</code>로 tcp를 통해 네트워크 모드로 접속</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 438px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACl0lEQVQ4y32SS2/bRhSF9esLFEF2XfQPNElRoEkXRbNwjNR2VSeyKVMiOXxIIkVKfA4fEv1QgLZfMSNFiF00iw9n5g7m8MzlHXz/W8x3vy759ueQZ6+/RvS/PH8T8c1PC07GBYNfRgmvP8T8+MdS8+oJn2svL6LHnIe8OPDqIuSHs4iRnzMQNydMr94SeRd82vrUmYWYDJmJEaFv4FmXRIHBrs/41Gdad33KXw8Vf+8k/+xqdn1Btba56xIG5vg9xtUp63iKLD2SWGBZN3ieje87OI5JEAikzKlljpQZTVMyn01wnY+4YsQynFJkHrWMGcz9jyjy1EYWLutE4IoJ87lgMRcEvsVyGbDdyAMVt33DIhjjTM/wnCFxaFCXLo0yrHKPqvApM5d87VCkDk3lU5eeRu3ztcU6Nh+hApSZoMiEvpcmU9o6YeBM3zMZv+Pqw1uWC4N05WJbNwjH1HRtqRP1fa31tq910k1XHSj1vm0yZBUzcG0LT9j47oQqt1nFjjaazxxmgc0qWbBeLcjS6KBL2qagqbMvyJFlsje0pwtcERF4Aa10WYYWE/Na99G2xpg3VxjXl1jTMaPRUKdXqbebmr5v6bcqdadre8PJKZPxCbJwdGNVwqpMebjfcHfbalXc33VH7fuGMlN9d6hyoVFr3UPP+RPPuaRIxdEwXUd0baGf0jafKY5rlUYZylzoyVBU+cHQNE6xzDP9x1RRliEP9z39tuX+TqXs9PMe01BkwSHdE0M1Ik0V6AM1JnE4xjLPWcyuMY3fEdaQMlcXvCe4x3R7Q7E3LDOLMrM1shAkkYFrnxPNR3pwA3eoz1QCNQV7/S/Kp5FLBm0d0zWJRn1h067oNymbdk2/ydh26fH8ayiffiv5Fyr1Nv/Pm6tjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012034549571\"\n        title=\"image-20221012034549571\"\n        src=\"/static/066e158fd34660545f3e0fbe2b8adc5f/50e4b/image-20221012034549571.png\"\n        srcset=\"/static/066e158fd34660545f3e0fbe2b8adc5f/e9ff0/image-20221012034549571.png 180w,\n/static/066e158fd34660545f3e0fbe2b8adc5f/f21e7/image-20221012034549571.png 360w,\n/static/066e158fd34660545f3e0fbe2b8adc5f/50e4b/image-20221012034549571.png 438w\"\n        sizes=\"(max-width: 438px) 100vw, 438px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>주의: H2 데이터베이스의 <u><strong>MVCC</strong></u> 옵션은 H2 1.4.198 버전부터 제거되었습니다. 1.4.200 버전에서는 MVCC 옵션을 사용하면 오류가 발생합니다.</p>\n</blockquote>\n<h2 id=\"-jpa와-db-설정-동작확인\" style=\"position:relative;\"><a href=\"#-jpa%EC%99%80-db-%EC%84%A4%EC%A0%95-%EB%8F%99%EC%9E%91%ED%99%95%EC%9D%B8\" aria-label=\" jpa와 db 설정 동작확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 JPA와 DB 설정, 동작확인</h2>\n<ul>\n<li>\n<p>application properties나 yaml 둘 중 하나 선택하면 되는데, 설정이 많아지면 yaml이 더 편해서 yaml을 선호하는 편이다.</p>\n</li>\n<li>\n<p>datasource로 db 설정하면 스프링부트가 HikariCP를 써서 커넥션풀 등 세팅을 다 해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>h2<span class=\"token punctuation\">:</span>tcp<span class=\"token punctuation\">:</span>//localhost/~jpashop;\n    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> sa\n    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> org.h2.Driver</code></pre></div>\n</li>\n<li>\n<p>jpa 관련 설정 해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\">#...</span>\n  <span class=\"token key atrule\">jpa</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">hibernate</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ddl-auto</span><span class=\"token punctuation\">:</span> create\n    <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">hibernate</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">show_sql</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">format_sql</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">ddl-auto: create</code> 자동으로 만들어주는데, 이미 있는 건 다 지운다.</p>\n<ul>\n<li>\n<p>실제로 실행 후 로그를 보면 지우고 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">drop table if exists member CASCADE \n...\ndrop sequence if exists hibernate_sequence\n...\ncreate table member (\nid bigint not null,\nusername varchar(255),\nprimary key (id)\n)</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>hibernate 관련 설정 -> 쿼리 보여주고.. 등등</p>\n<ul>\n<li>이런 설정들을 보고 싶다면… <a href=\"https://docs.spring.io/spring-boot/docs/2.1.7.RELEASE/reference/html/\"><strong>Spring Boot Reference Guide</strong></a>를 보면서 다 하나하나 배우세용 ^_^!!</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>로깅 설정 해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">level</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">org.hibernate.SQL</span><span class=\"token punctuation\">:</span> debug</code></pre></div>\n<ul>\n<li>하이버네이트가 날리는 쿼리를 로그로 다 남긴다.</li>\n<li>어라라? 근데 위에서 <code class=\"language-text\">show_sql</code>을 했으니까 필요가 없는 거 아닌가?</li>\n<li>맞다! 그래서 위에는 주석 처리해주자. 둘의 차이점은, show_sql은 sout으로 출력한다는 점이다. 실제로는 다 로그로만 남겨야 한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"코드-작성\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\" aria-label=\"코드 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 작성</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">Member</code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span> <span class=\"token comment\">// 자동 생성되도록</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>JPA가 관리하는 객체임을 알려주기 위해 객체에 <code class=\"language-text\">@Entity</code> 추가한다.</p>\n</li>\n<li>\n<p>이 때 <code class=\"language-text\">@GeneratedValue</code>를 통해 Id가 자동 생성된다.. 그런데 저번에 입문일 때는 strategy로 GenerationType.IDENTITY를 넣었는데, 이번엔 넣지 않았다.</p>\n</li>\n<li>\n<p>기본 디폴트는 GenerationType.AUTO라고 한다.</p>\n</li>\n<li>\n<p>AUTO의 경우 DB 벤더에 따라 자동으로 3가지 전략 중 하나를 선택한다. 따라서 DB 벤더를 변경해도 전략을 수정하지 않아도 되지만, 해당 벤더가 SEQUENCE나 TABLE 전략을 사용한다면 sequence나 키 테이블을 생성해두어야 한다.</p>\n<ul>\n<li>근데 JPA <code class=\"language-text\">ddl-auto</code> 기능을 생성하면 hibernate가 알아서 시퀀스 테이블을 생성해준다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">create sequence hibernate_sequence start with 1 increment by 1</code></pre></div>\n<ul>\n<li>아마 이건가?</li>\n<li>H2의 경우는 sequence를 사용한다.</li>\n<li>결론은 <u><strong>jpa ddl auto 설정</strong></u>이 되어 있어야 한다.</li>\n</ul>\n</li>\n<li>\n<p>IDENTITY를 사용할 경우 기본키 생성을 DB에게 위임한다. (MySQL AUTO INCREMENT처럼) 이 경우엔 애플리케이션이 아닌 DB가 id값을 담당하므로, id 값이 얼마인지를 알려면 DB에 꼭 insert문을 날려야 한다.</p>\n<ul>\n<li>참고: <a href=\"https://newwisdom.tistory.com/90\">[JPA] 기본 키 생성 전략과 각 전략의 차이 - GenerationType</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">MemberRepository</code></p>\n<ul>\n<li>\n<p>jpa이므로 entity manager가 필요하다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">@PersistenceContext</code> 애노테이션이 있으면 스프링부트가 설정파일을 읽고 EntityManager를 주입해준다.</p>\n</li>\n<li>\n<p>이 때 save 후 굳이 id만 리턴하는 게 아니고 멤버를 리턴할 수도 있지만,</p>\n<blockquote>\n<h3 id=\"command와-query를-분리하라\" style=\"position:relative;\"><a href=\"#command%EC%99%80-query%EB%A5%BC-%EB%B6%84%EB%A6%AC%ED%95%98%EB%9D%BC\" aria-label=\"command와 query를 분리하라 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>command와 query를 분리하라</h3>\n<p>는 규칙을 따르기 위해서, 저장(명령 수행) 후에는 가급적이면 return 값을 만들지 않는다. id 정도만 조회를 위해 반환한다.</p>\n<ul>\n<li>\n<p>객체의 상태 조회: 쿼리 (query)</p>\n</li>\n<li>\n<p>객체의 상태 변경: 명령 (command)</p>\n</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@PersistenceContext</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EntityManager</span> em<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Long</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        em<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 조회</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Member</span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>테스트</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// @ExtendWith(SpringExtension.class)</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberRepositoryTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span> <span class=\"token class-name\">MemberRepository</span> memberRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testMember</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//given</span>\n        <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        member<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//when</span>\n        <span class=\"token class-name\">Long</span> id <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Member</span> foundMember <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//then</span>\n        <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>foundMember<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>foundMember<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">@SpringBootTest</code>를 읽고 <code class=\"language-text\">@SpringBootApplication</code>이 있는 곳에서  Context를 읽어 온다.</p>\n</li>\n<li>\n<p>이 때 강의에선 <code class=\"language-text\">@RunWith(SpringRunner.class</code>를 사용했다. 그런데 강의에선 <code class=\"language-text\">Junit4</code>를 사용했는데, 왠지 Junit5를 사용하고 싶어서… 저 애노테이션은 없어졌다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">@ExtendWith(SpringExtension.class)</code>를 대신해서 써야 한다.</p>\n<ul>\n<li>참고: <a href=\"https://prayme.tistory.com/17\">Junit5에서 RunWith 대신 ExtendWith</a></li>\n</ul>\n</li>\n<li>\n<p>그런데! 원래(JUnit4)는 스프링 부트 기능인  @Autowired 등을 사용하기 위해서 사용했던 애노테이션인데… JUnit 5에서는 굳이 ExtendWith로 추가할 필요가 없다고 한다. 그래서 애노테이션 지워봐도 잘 작동된다!</p>\n<blockquote>\n<p>@RunWith is an old annotation from JUnit 4 to use test runners. If you’re using JUnit 5 (Jupiter), you should use @ExtendWith to use JUnit extensions</p>\n<p>See <a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-testing\">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-testing</a></p>\n<p>“If you are using JUnit 4, don’t forget to also add @RunWith(SpringRunner.class) to your test, otherwise the annotations will be ignored. If you are using JUnit 5, there’s no need to add the equivalent @ExtendWith(SpringExtension.class) as @SpringBootTest and the other @…Test annotations are already annotated with it.</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p>이 때 테스트 시</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Invocation of init method failed; nested exception is org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment]\n\tat app//org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1788)</code></pre></div>\n<p>뭐 이런 오류가 뜬다면? yaml에 url, username, password 잘 썼는 지 확인해보자.</p>\n</li>\n<li>\n<p>그런데! 위 코드는 오류가 난다. 바로바로 <code class=\"language-text\">@Transactional</code>이 빠졌기 때문이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">No EntityManager with actual transaction available for current thread</code></pre></div>\n<ul>\n<li>지금 transaction이 없다는 말이 나온다.</li>\n<li><u><strong>EntityManager를 통한 모든 데이터 변경은 항상 트랜잭션 안에서 이루어져야 한다.</strong></u>✨✨✨</li>\n<li>근데 지금 트랜잭션을 걸지 않고 있다! 일단 Repository 클래스에 <code class=\"language-text\">@Transactional</code>을 걸어줘도 되지만, 우선 테스트에 걸어보자.\n<ul>\n<li>이 때 애노테이션이 자바 표준이 제공하는 것도 있고 (javax.transaction) 스프링에도 있는데, 스프링을 쓰고 있으니까 스프링이 제공하는 것을 쓰자. 옵션을 많이 제공한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>그리고 스프링에선 <code class=\"language-text\">@Transactional</code>이 <code class=\"language-text\">@Test</code>와 같이 있으면,  자동으로 테스트가 종료 후에 rollback을 한다. 당연히 테스트는 반복적으로 실행될 수 있으니까 필요하다. 그런데 rollback 안하고 db 테이블에 내 눈으로 보고 싶다면? <code class=\"language-text\">@Rollback(false)</code> 애노테이션을 붙이면 롤백이 안된다.</p>\n<ul>\n<li>\n<p>와~</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 386px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoUlEQVQY05WOyw6CMAAE+f+PEqM8aqG8BASMBVqBi4mAonJaEw5ET8phspfNZJQ0MlALF4LbyOItsljH3tvAZypE7mHoStyu+cS9LX6i7Iw1KAnAaAh1RUCJgePBRBYTNDKcTouEZylhWScwxuG4FaSo8ewLjEOFRy/+Fs3CphZwmA7b0iDKFOOrQ3vhX1WLCqNAwzGhSEITgvuz4HOXFL4Bzixv6Bl6k+cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012050141717\"\n        title=\"image-20221012050141717\"\n        src=\"/static/230f8cafbc0f0b2ae2ebea8d31e56b9d/7bc0b/image-20221012050141717.png\"\n        srcset=\"/static/230f8cafbc0f0b2ae2ebea8d31e56b9d/e9ff0/image-20221012050141717.png 180w,\n/static/230f8cafbc0f0b2ae2ebea8d31e56b9d/f21e7/image-20221012050141717.png 360w,\n/static/230f8cafbc0f0b2ae2ebea8d31e56b9d/7bc0b/image-20221012050141717.png 386w\"\n        sizes=\"(max-width: 386px) 100vw, 386px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>이 때, 찾은 멤버와 원래 멤버가 id, username이 같은 건 맞다. 그런데 같은 객체(엔티티)기도 할까?</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>foundMember<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isSameAs</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>실행해보면 맞다!\n<ul>\n<li>지금 같은 트랜잭션 내에서 저장 후에, 조회하므로 <u><strong>영속성 컨텍스트가 같다</strong></u>. 영속성 컨텍스트 안에서는 id값이 같으면 같은 엔티티이다.\n<ul>\n<li>JPA에서 영속성 컨텍스트에서 객체를 관리할 때는 id(pk)를 map의 key로 해서 객체를 넣고 관리하므로 (아마도)</li>\n</ul>\n</li>\n<li>따라서 그냥 기존에 관리하던 걸 찾아준다. 실행된 쿼리를 봐도 <u><strong>select 문이 실행되지도 않았다</strong></u>는 걸 알 수 있다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>참고: 스프링 부트를 통해 복잡한 설정이 다 자동화 되었다. persistence.xml 도 없 고, LocalContainerEntityManagerFactoryBean 도 없다. 스프링 부트를 통한 추가 설정은 스프링 부트 메뉴얼을 참고하고, 스프링 부트를 사용하지 않고 순수 스프링과 JPA 설정 방법은 자바 ORM 표준 JPA 프 로그래밍 책을 참고하자.</p>\n</blockquote>\n<ul>\n<li>\n<p>쿼리 파라미터 로그 남기기</p>\n<ul>\n<li>\n<p>실행 결과를 확인해보면, sql이 어느 타이밍에 실행되는지, 쿼리 파라미터가 뭔지 확인하는 게 좀 불편하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 450px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwUlEQVQY04VQ2w6CMBTb5yggMEEuuxDBAYJRI4n//ynVDRAIJD40pztJe9oR22eIuUJRPXFiFziU43AUC0w7jgPlcFZc9JMKEMtLIYsbqraDNrc8tmE2GNLepH+PXEw7ykG0wAskIq6gmhfEucHOTWDr64PAmQnWhstJtGDvpkbY3N8GRfVAKmuw7GpST4lnabe4rqwFiaxQNh1YVsMPMwRJDi/MDH7/R8fKW3yCqewGEjEvIfIWEVPGxNmq/A/fyh/Z8sMlMnn8gQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012051136274\"\n        title=\"image-20221012051136274\"\n        src=\"/static/3db03b5f9dcba5afff358d6fb8dcf8cc/fc2a6/image-20221012051136274.png\"\n        srcset=\"/static/3db03b5f9dcba5afff358d6fb8dcf8cc/e9ff0/image-20221012051136274.png 180w,\n/static/3db03b5f9dcba5afff358d6fb8dcf8cc/f21e7/image-20221012051136274.png 360w,\n/static/3db03b5f9dcba5afff358d6fb8dcf8cc/fc2a6/image-20221012051136274.png 450w\"\n        sizes=\"(max-width: 450px) 100vw, 450px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>뭔지 안나온다!</li>\n</ul>\n</li>\n<li>\n<p>yaml에 logging.level에 <code class=\"language-text\">org.hibernate.type : trace</code>로 sql 실행 후에 들어간 파라미터를 알려준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 365px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgklEQVQI162OSxKDIADFvE7BkUW18hULgtr73ydWpkfoIrs3eemEEPwDKSVSCDpjDDllliXirCPnzLq+mWeNNRZrbxy17pznhyVGlFKklNi2Qowrahh4/KSdc45aShuEEKilNqnWGu89znt8CBzHyV4rz3Fkml7t7C7r+76JWulXeAHdFWD9GAtoagAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012051303203\"\n        title=\"image-20221012051303203\"\n        src=\"/static/a8ca5f0faba0ab81079203342cecd4b4/2e8d1/image-20221012051303203.png\"\n        srcset=\"/static/a8ca5f0faba0ab81079203342cecd4b4/e9ff0/image-20221012051303203.png 180w,\n/static/a8ca5f0faba0ab81079203342cecd4b4/f21e7/image-20221012051303203.png 360w,\n/static/a8ca5f0faba0ab81079203342cecd4b4/2e8d1/image-20221012051303203.png 365w\"\n        sizes=\"(max-width: 365px) 100vw, 365px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p>근데 외부 라이브러리가 있다!</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/gavlyukovskiy/spring-boot-data-source-decorator\">spring-boot-data-source-decorator</a>에서 <a href=\"https://github.com/p6spy/p6spy\">P6Spy</a>를 사용해보자.</p>\n</li>\n<li>\n<p>database connection 을 wrapping해서, 만들어진 sql문을 이해해서 로그로 출력해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\"><span class=\"token function\">implementation</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">\"com.github.gavlyukovskiy:p6spy-spring-boot-starter:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">version</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>왜 gradle에 다른 라이브러리들은 버전을 안쓰는데, 이 경우에만 써야 할까? 스프링 부트가 자신의 버전에 궁합이 맞는 라이브러리들은 다 세팅을 해뒀는데, 스프링 부트가 지원하지 않는(그래서 미리 세팅을 하지 않은) 라이브러리들은 버전을 적어줘야한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 491px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQY0zWQ2XKDMAxF+aE0TBqMwzjEYMxis4St//8np2OnfdBcjaQ50lWSNTOiWwmamRlh34h2RbqDb+24m4m822L/S2iusuZyUwi7cK88cjg+6g4yM5Go2mOGjacZ0e2McRuN31H1iOlXrNspKkfZTJRmpGoXpLIU2iHKjlTWXIX+aF6RBFAABnAAWr9j/RGBIe/GE2XGCNR2wvRvpGrjomZYyVRL8epJheZye5KE0/8thci7lbzfkO6MFkJN9huiWeIF6cNEy2Eu9B/+/NOf+IZfsqiOQqxrJecAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221012051946757\"\n        title=\"image-20221012051946757\"\n        src=\"/static/98ef2c8b0e5befcd52e681df37f262aa/13566/image-20221012051946757.png\"\n        srcset=\"/static/98ef2c8b0e5befcd52e681df37f262aa/e9ff0/image-20221012051946757.png 180w,\n/static/98ef2c8b0e5befcd52e681df37f262aa/f21e7/image-20221012051946757.png 360w,\n/static/98ef2c8b0e5befcd52e681df37f262aa/13566/image-20221012051946757.png 491w\"\n        sizes=\"(max-width: 491px) 100vw, 491px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>원본과 파라미터로 넣은 값이 나온다!</li>\n<li>로그 옵션을 바꾸고 쉽다면 위 깃헙 레포에서 확인하자.</li>\n</ul>\n</li>\n<li>\n<p>하지만 고민해야할 것은, 그냥 혼자 개발할 때는 괜찮지만 운영에 배포할 때는 고민을 해봐야한다. <u><strong>성능 테스트</strong></u>를 해봐야 한다.</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\">☘️ 프로젝트 환경 설정</a></p>\n<ul>\n<li>\n<p><a href=\"#-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\">📌 프로젝트 생성</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\">📌 라이브러리 살펴보기</a></p>\n</li>\n<li>\n<p><a href=\"#-view-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\">📌 View 환경 설정</a></p>\n</li>\n<li>\n<p><a href=\"#-h2-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%84%A4%EC%B9%98\">📌 H2 데이터베이스 설치</a></p>\n</li>\n<li>\n<p><a href=\"#-jpa%EC%99%80-db-%EC%84%A4%EC%A0%95-%EB%8F%99%EC%9E%91%ED%99%95%EC%9D%B8\">📌 JPA와 DB 설정, 동작확인</a></p>\n<ul>\n<li><a href=\"#%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\">코드 작성</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"October 11, 2022","title":"01. 프로젝트 환경 설정 - 실전! 스프링 부트와 JPA 활용1","categories":"강의","author":"goldggyul","emoji":null,"imageEmoji":"hibernate-logo.png"},"fields":{"slug":"/spring-jpa-use-001/"}},"prev":{"id":"515434f5-cb21-59ea-8986-b2b8e11e286c","html":"<blockquote>\n<p>본 게시글은 <a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/\">실전! 스프링 부트와 JPA 활용1</a> 강의를 듣고 정리했습니다.</p>\n</blockquote>\n<h1 id=\"️-애플리케이션-구현-준비\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EA%B5%AC%ED%98%84-%EC%A4%80%EB%B9%84\" aria-label=\"️ 애플리케이션 구현 준비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>☘️ 애플리케이션 구현 준비</h1>\n<h2 id=\"-요구사항-분석\" style=\"position:relative;\"><a href=\"#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D\" aria-label=\" 요구사항 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 요구사항 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACUElEQVQ4y5WU208TQRTG+x/4YGLim4/+QyQagUgxIBIVJWo0RBJCjGKID/pg4hNqgmK4lUKpAloCalGiBLYXai8m2y3dy+zsveXlMzNlSQURePhlZs5+8805J7MTcL0KiGFBNyw+1qNRk0N22F3v0fM5NWE7LgKW46Ioa5AUAkn20VBSCFRqQWHoZg1qQaU2tlSda3w90xbLGjcO2I7HA0zEYHOZGCiIJUyEI5iPLSG2/BULi8uYjs5hfGoGG6kMP6B+H0uImva/Df0xnS0gsZnFz40kN0n9yiOZyfHs6rW1jA8xLBS3kMjkOWuJNNaENIR0FslMHtnfIsoaPZohO123XIQic+i6fR93ex/gVk8/uu/1oafvEW7c6cWLoWGu8TM9NEPWnx/rSbybnMF4+D3GpqIYDUUwHo5iZGIaS/HV/T08yNA31QybZ6FSE5KsoqRo3ITFiOns2/Pfkqnt4e1YCOeagui41o2LbZ1obr2Mts4unG9uxZNnz2E4FRTL6tEMDdvDm9FJNDQG0X71JpoudeBCsB2tV66jobEFg0+PYeiXTHQDBqHQFA1laYujySqP6bpxjJJZ/wjFx6yI/riAwdUUHq8IGIgLGPiW4LHRZB6EUK491LAoEzjUxMMVASdfzuLsyAJOv47i1KtZnBn+gBNDEbTMf4dLTYjyES+2rOrYLCmI5UTO54KELwUJi7kiPuVErItlrjnw2vg/uI+0Y0qJwdFZ3wjdXatarTX1e9gDo5sWAtXtbThuBY73N7brwToA9m2v3nE9VKpV/AFG3X9pGsSpEAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221013220035667\"\n        title=\"image-20221013220035667\"\n        src=\"/static/3e4eef5eefee81b71bbeec7129ffe068/37523/image-20221013220035667.png\"\n        srcset=\"/static/3e4eef5eefee81b71bbeec7129ffe068/e9ff0/image-20221013220035667.png 180w,\n/static/3e4eef5eefee81b71bbeec7129ffe068/f21e7/image-20221013220035667.png 360w,\n/static/3e4eef5eefee81b71bbeec7129ffe068/37523/image-20221013220035667.png 720w,\n/static/3e4eef5eefee81b71bbeec7129ffe068/302a4/image-20221013220035667.png 1080w,\n/static/3e4eef5eefee81b71bbeec7129ffe068/07a9c/image-20221013220035667.png 1440w,\n/static/3e4eef5eefee81b71bbeec7129ffe068/8bb81/image-20221013220035667.png 1602w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>회원 기능\n<ul>\n<li>회원 등록</li>\n<li>회원 조회</li>\n</ul>\n</li>\n<li>상품 기능\n<ul>\n<li>상품 등록</li>\n<li>상품 수정</li>\n<li>상품 조회</li>\n</ul>\n</li>\n<li>주문 기능\n<ul>\n<li>상품 주문</li>\n<li>주문 내역 조회</li>\n<li>주문 취소</li>\n</ul>\n</li>\n</ul>\n<p>예제를 단순화 하기 위해 다음 기능은 구현X</p>\n<ul>\n<li>로그인과 권한 관리X</li>\n<li>파라미터 검증과 예외 처리X</li>\n<li>상품은 도서만 사용</li>\n<li>카테고리는 사용X</li>\n<li>배송 정보는 사용X</li>\n</ul>\n<h2 id=\"-애플리케이션-아키텍처\" style=\"position:relative;\"><a href=\"#-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98\" aria-label=\" 애플리케이션 아키텍처 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 애플리케이션 아키텍처</h2>\n<p><u><strong>계층형 구조 사용</strong></u></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAy0lEQVQY022QSQ6EMAwE8//ncYETcGDf9x08KkuDEDORrMROud2J6fte0jSVIAikKAoZhkGappG6riUMQ8nzXLquk2malIvjWKIo0vq6rtpDDkufASZxHEdFGVBVlbRtK67rqgg1BsHZtq31JElUkPuyLDXoMdu2CcElExgwz7OM43jnnHFIA+d937WHdZ6nusyyTBlD4b1ww5MsyxLP81T4uq4f7l0jvwVJvgAOEfF9X/8MV0/myT6F0TLHccg7eBL2l2W5d+B/7Ds+u/zO+gBwZegAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20221013220552362\"\n        title=\"image-20221013220552362\"\n        src=\"/static/0efe858f453c91eda320dabc1cf4eca1/37523/image-20221013220552362.png\"\n        srcset=\"/static/0efe858f453c91eda320dabc1cf4eca1/e9ff0/image-20221013220552362.png 180w,\n/static/0efe858f453c91eda320dabc1cf4eca1/f21e7/image-20221013220552362.png 360w,\n/static/0efe858f453c91eda320dabc1cf4eca1/37523/image-20221013220552362.png 720w,\n/static/0efe858f453c91eda320dabc1cf4eca1/302a4/image-20221013220552362.png 1080w,\n/static/0efe858f453c91eda320dabc1cf4eca1/07a9c/image-20221013220552362.png 1440w,\n/static/0efe858f453c91eda320dabc1cf4eca1/29007/image-20221013220552362.png 1600w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>controller, web: 웹 계층\n<ul>\n<li>서비스 뿐만 아니라 repository도 접근할 수 있음. 대신 반대 방향은 X</li>\n<li>컨트롤러에서 간단하게 리포지토리를 부르면 끝나는데, 서비스는 단순하게 위임만 할 때 실용적인 관점에서는 좋진 않다.</li>\n</ul>\n</li>\n<li>service: 비즈니스 로직, 트랜잭션 처리</li>\n<li>repository: JPA를 직접 사용하는 계층, 엔티티 매니저 사용</li>\n<li>domain: 엔티티가 모여 있는 계층, 모든 계층에서 사용</li>\n</ul>\n<p><u><strong>패키지 구조</strong></u></p>\n<ul>\n<li>jpabook.jpashop\n<ul>\n<li>domain</li>\n<li>exception: 공통 예외</li>\n<li>repository</li>\n<li>service</li>\n<li>web</li>\n</ul>\n</li>\n</ul>\n<p><u><strong>개발 순서</strong></u></p>\n<ul>\n<li>서비스, 리포지토리 계층을 개발하고, 테스트 케이스를 작성해서 검증, 마지막에 웹 계층 적용</li>\n</ul>\n<h1 id=\"️-회원-도메인-개발\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%ED%9A%8C%EC%9B%90-%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B0%9C%EB%B0%9C\" aria-label=\"️ 회원 도메인 개발 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>☘️ 회원 도메인 개발</h1>\n<h2 id=\"-회원-리포지토리-개발\" style=\"position:relative;\"><a href=\"#-%ED%9A%8C%EC%9B%90-%EB%A6%AC%ED%8F%AC%EC%A7%80%ED%86%A0%EB%A6%AC-%EA%B0%9C%EB%B0%9C\" aria-label=\" 회원 리포지토리 개발 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 회원 리포지토리 개발</h2>\n<h2 id=\"-회원-서비스-개발\" style=\"position:relative;\"><a href=\"#-%ED%9A%8C%EC%9B%90-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%9C%EB%B0%9C\" aria-label=\" 회원 서비스 개발 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 회원 서비스 개발</h2>\n<h2 id=\"-회원-기능-테스트\" style=\"position:relative;\"><a href=\"#-%ED%9A%8C%EC%9B%90-%EA%B8%B0%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\" 회원 기능 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📌 회원 기능 테스트</h2>","frontmatter":{"date":"October 13, 2022","title":"03. 회원 도메인 개발 - 실전! 스프링 부트와 JPA 활용1","categories":"강의","author":"goldggyul","emoji":null,"imageEmoji":"hibernate-logo.png"},"fields":{"slug":"/spring-jpa-use-003/"}},"site":{"siteMetadata":{"siteUrl":"https://goldggyul.github.io","comments":{"utterances":{"repo":"goldggyul/goldggyul.github.io"}}}}},"pageContext":{"slug":"/spring-jpa-use-002/","nextSlug":"/spring-jpa-use-001/","prevSlug":"/spring-jpa-use-003/"}},"staticQueryHashes":["1956554647","2938748437","3350743975","3454833782"]}